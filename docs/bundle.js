(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
class Bullet extends Body {
    constructor(center, velocity) {
        super();
        this.size = { x: 3, y: 3 };
        this.center = center;
        this.velocity = velocity;
    }
    update() {
        this.center.x += this.velocity.x;
        this.center.y += this.velocity.y;
    }
}
exports.Bullet = Bullet;

},{}],2:[function(require,module,exports){
"use strict";
const util_1 = require("./util");
const player_1 = require("./player");
const invader_1 = require("./invader");
const keys_1 = require("./keys");
class Game {
    constructor(domId) {
        this.canvas = document.getElementById(domId);
        this.canvas.onclick = this.reset.bind(this);
        this.gameSize = { x: this.canvas.width, y: this.canvas.height };
        this.screen = this.canvas.getContext("2d");
        window.addEventListener("keyup", (event) => {
            if (event.keyCode === keys_1.KEYS.R) {
                this.reset();
            }
        });
    }
    addBody(body) {
        this.bodies.push(body);
    }
    tick() {
        if (!this.hasPlayer()) {
            this.loseGame();
            return;
        }
        if (!this.hasInvaders()) {
            this.winGame();
            return;
        }
        this.update();
        this.draw();
        requestAnimationFrame(this.tick.bind(this));
    }
    invadersBelow(invader) {
        return this.bodies.filter((body) => {
            return body instanceof invader_1.Invader &&
                body.center.y > invader.center.y &&
                body.center.x - invader.center.x < invader.size.x;
        });
    }
    start() {
        this.reset();
    }
    reset() {
        this.bodies = util_1.Util.produceInvaders(this);
        this.bodies.push(new player_1.Player(this));
        this.tick();
    }
    draw() {
        this.screen.clearRect(0, 0, this.gameSize.x, this.gameSize.y);
        for (let i = 0; i < this.bodies.length; i++) {
            util_1.Util.drawRect(this.screen, this.bodies[i]);
        }
    }
    update() {
        let bodies = this.bodies;
        const notCollidingWithAnything = (b1) => {
            return bodies.filter((b2) => {
                return util_1.Util.colliding(b1, b2);
            }).length === 0;
        };
        this.bodies = this.bodies.filter(notCollidingWithAnything);
        for (let i = 0; i < this.bodies.length; i++) {
            this.bodies[i].update();
        }
    }
    hasPlayer() {
        return this.bodies.filter((body) => {
            return body instanceof player_1.Player;
        }).length === 1;
    }
    hasInvaders() {
        return this.bodies.filter((body) => {
            return body instanceof invader_1.Invader;
        }).length > 0;
    }
    loseGame() {
        this.displayMessage("Game Over");
    }
    winGame() {
        this.displayMessage("You Win!");
    }
    displayMessage(text) {
        this.screen.font = "48px serif";
        this.screen.textAlign = "center";
        this.screen.fillText(text, this.gameSize.x / 2, this.gameSize.y / 2);
    }
}
exports.Game = Game;

},{"./invader":3,"./keys":5,"./player":7,"./util":8}],3:[function(require,module,exports){
"use strict";
const bullet_1 = require("./bullet");
class Invader extends Body {
    constructor(game, center) {
        super();
        this.size = { x: 15, y: 15 };
        this.bulletChance = 0.99;
        this.game = game;
        this.center = center;
        this.patrolX = 0;
        this.speedX = 0.3;
    }
    update() {
        if (this.patrolX < 0 || this.patrolX > 40) {
            this.speedX = -this.speedX;
        }
        this.center.x += this.speedX;
        this.patrolX += this.speedX;
        if (Math.random() > this.bulletChance && !this.game.invadersBelow(this).length) {
            let bullet = new bullet_1.Bullet({ x: this.center.x, y: this.center.y + this.size.x / 2 }, { x: Math.random() - 0.5, y: 2 });
            this.game.addBody(bullet);
        }
    }
}
exports.Invader = Invader;

},{"./bullet":1}],4:[function(require,module,exports){
"use strict";
class Keyboarder {
    constructor() {
        this.keyState = [];
        window.addEventListener("keydown", (event) => {
            this.keyState[event.keyCode] = true;
        });
        window.addEventListener("keyup", (event) => {
            this.keyState[event.keyCode] = false;
        });
    }
    isDown(keyCode) {
        return this.keyState[keyCode] === true;
    }
}
exports.Keyboarder = Keyboarder;

},{}],5:[function(require,module,exports){
"use strict";
exports.KEYS = {
    LEFT: 37,
    R: 82,
    RIGHT: 39,
    SPACE: 32,
};

},{}],6:[function(require,module,exports){
"use strict";
const game_1 = require("./game");
window.onload = function () {
    const game = new game_1.Game("screen");
    game.start();
};

},{"./game":2}],7:[function(require,module,exports){
"use strict";
const bullet_1 = require("./bullet");
const keyboarder_1 = require("./keyboarder");
const keys_1 = require("./keys");
class Player extends Body {
    constructor(game) {
        super();
        this.size = { x: 15, y: 15 };
        this.game = game;
        this.keyboarder = new keyboarder_1.Keyboarder();
        this.center = { x: this.game.gameSize.x / 2, y: this.game.gameSize.y - this.size.x };
    }
    update() {
        if (this.keyboarder.isDown(keys_1.KEYS.LEFT) && this.center.x - this.size.x / 2 > 0) {
            this.center.x -= 2;
        }
        else if (this.keyboarder.isDown(keys_1.KEYS.RIGHT) && this.center.x + this.size.x / 2 < this.game.gameSize.x) {
            this.center.x += 2;
        }
        if (this.keyboarder.isDown(keys_1.KEYS.SPACE)) {
            let bullet = new bullet_1.Bullet({ x: this.center.x, y: this.center.y - this.size.x / 2 }, { x: 0, y: -6 });
            this.game.addBody(bullet);
        }
    }
}
exports.Player = Player;

},{"./bullet":1,"./keyboarder":4,"./keys":5}],8:[function(require,module,exports){
"use strict";
const invader_1 = require("./invader");
class Util {
    static produceInvaders(game) {
        let invaders = [];
        for (let i = 0; i < 24; i++) {
            let x = 30 + (i % 8) * 30;
            let y = 30 + (i % 3) * 30;
            invaders.push(new invader_1.Invader(game, { x: x, y: y }));
        }
        return invaders;
    }
    static colliding(b1, b2) {
        return !(b1 === b2 ||
            b1.center.x + b1.size.x / 2 < b2.center.x + b2.size.x / 2 ||
            b1.center.y + b1.size.y / 2 < b2.center.y + b2.size.y / 2 ||
            b1.center.x - b1.size.x / 2 > b2.center.x + b2.size.x / 2 ||
            b1.center.y - b1.size.y / 2 > b2.center.y + b2.size.y / 2);
    }
    static drawRect(screen, body) {
        screen.fillRect(body.center.x - body.size.x / 2, body.center.y - body.size.y / 2, body.size.x, body.size.y);
    }
}
exports.Util = Util;

},{"./invader":3}]},{},[6])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYnVsbGV0LnRzIiwic3JjL2dhbWUudHMiLCJzcmMvaW52YWRlci50cyIsInNyYy9rZXlib2FyZGVyLnRzIiwic3JjL2tleXMudHMiLCJzcmMvbWFpbi50cyIsInNyYy9wbGF5ZXIudHMiLCJzcmMvdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7QUNBQSxxQkFBNEIsSUFBSTtJQUk1QixZQUFZLE1BQWMsRUFBRSxRQUFrQjtRQUMxQyxPQUFPLENBQUM7UUFKTCxTQUFJLEdBQVMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQztRQUs3QixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztJQUM3QixDQUFDO0lBRU0sTUFBTTtRQUNULElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7QUFDTCxDQUFDO0FBZFksY0FBTSxTQWNsQixDQUFBOzs7O0FDZEQsdUJBQXFCLFFBQVEsQ0FBQyxDQUFBO0FBQzlCLHlCQUF1QixVQUFVLENBQUMsQ0FBQTtBQUNsQywwQkFBd0IsV0FBVyxDQUFDLENBQUE7QUFDcEMsdUJBQXFCLFFBQVEsQ0FBQyxDQUFBO0FBRTlCO0lBTUksWUFBWSxLQUFhO1FBQ3JCLElBQUksQ0FBQyxNQUFNLEdBQXVCLFFBQVEsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDakUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUMsSUFBSSxD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LEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQzFCLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDMUIsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLGlCQUFPLENBQUMsSUFBSSxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25ELENBQUM7UUFFRCxNQUFNLENBQUMsUUFBUSxDQUFDO0lBQ3BCLENBQUM7SUFFRCxPQUFjLFNBQVMsQ0FBQyxFQUFRLEVBQUUsRUFBUTtRQUN0QyxNQUFNLENBQUMsQ0FBQyxDQUNKLEVBQUUsS0FBSyxFQUFFO1lBQ1QsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDekQsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDekQsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDekQsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FDNUQsQ0FBQztJQUNOLENBQUM7SUFFRCxPQUFjLFFBQVEsQ0FBQyxNQUFnQyxFQUFFLElBQVU7UUFDL0QsTUFBTSxDQUFDLFFBQVEsQ0FDWCxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQy9CLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFDL0IsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQ2QsQ0FBQztJQUNOLENBQUM7QUFDTCxDQUFDO0FBL0JZLFlBQUksT0ErQmhCLENBQUEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiZXhwb3J0IGNsYXNzIEJ1bGxldCBleHRlbmRzIEJvZHkge1xuICAgIHB1YmxpYyBzaXplOiBTaXplID0ge3g6IDMsIHk6IDN9O1xuICAgIHByb3RlY3RlZCB2ZWxvY2l0eTogVmVsb2NpdHk7XG5cbiAgICBjb25zdHJ1Y3RvcihjZW50ZXI6IENlbnRlciwgdmVsb2NpdHk6IFZlbG9jaXR5KSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuY2VudGVyID0gY2VudGVyO1xuICAgICAgICB0aGlzLnZlbG9jaXR5ID0gdmVsb2NpdHk7XG4gICAgfVxuXG4gICAgcHVibGljIHVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5jZW50ZXIueCArPSB0aGlzLnZlbG9jaXR5Lng7XG4gICAgICAgIHRoaXMuY2VudGVyLnkgKz0gdGhpcy52ZWxvY2l0eS55O1xuICAgIH1cbn1cbiIsImltcG9ydCB7IFV0aWwgfSBmcm9tIFwiLi91dGlsXCI7XG5pbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi9wbGF5ZXJcIjtcbmltcG9ydCB7IEludmFkZXIgfSBmcm9tIFwiLi9pbnZhZGVyXCI7XG5pbXBvcnQgeyBLRVlTIH0gZnJvbSBcIi4va2V5c1wiO1xuXG5leHBvcnQgY2xhc3MgR2FtZSB7XG4gICAgcHVibGljIGdhbWVTaXplOiBTaXplO1xuICAgIHByb3RlY3RlZCBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xuICAgIHByb3RlY3RlZCBib2RpZXM6IEJvZHlbXTtcbiAgICBwcm90ZWN0ZWQgc2NyZWVuOiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG5cbiAgICBjb25zdHJ1Y3Rvcihkb21JZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuY2FudmFzID0gPEhUTUxDYW52YXNFbGVtZW50PiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkb21JZCk7XG4gICAgICAgIHRoaXMuY2FudmFzLm9uY2xpY2sgPSB0aGlzLnJlc2V0LmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuZ2FtZVNpemUgPSB7eDogdGhpcy5jYW52YXMud2lkdGgsIHk6IHRoaXMuY2FudmFzLmhlaWdodH07XG4gICAgICAgIHRoaXMuc2NyZWVuID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuUikge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGFkZEJvZHkoYm9keTogQm9keSkge1xuICAgICAgICB0aGlzLmJvZGllcy5wdXNoKGJvZHkpO1xuICAgIH1cblxuICAgIHB1YmxpYyB0aWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuaGFzUGxheWVyKCkpIHtcbiAgICAgICAgICAgIHRoaXMubG9zZUdhbWUoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuaGFzSW52YWRlcnMoKSkge1xuICAgICAgICAgICAgdGhpcy53aW5HYW1lKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgdGhpcy5kcmF3KCk7XG5cbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMudGljay5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaW52YWRlcnNCZWxvdyhpbnZhZGVyOiBJbnZhZGVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJvZGllcy5maWx0ZXIoKGJvZHk6IEJvZHkpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBib2R5IGluc3RhbmNlb2YgSW52YWRlciAmJlxuICAgICAgICAgICAgICAgIGJvZHkuY2VudGVyLnkgPiBpbnZhZGVyLmNlbnRlci55ICYmXG4gICAgICAgICAgICAgICAgYm9keS5jZW50ZXIueCAtIGludmFkZXIuY2VudGVyLnggPCBpbnZhZGVyLnNpemUueDtcblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhcnQoKSB7XG4gICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuYm9kaWVzID0gVXRpbC5wcm9kdWNlSW52YWRlcnModGhpcyk7XG4gICAgICAgIHRoaXMuYm9kaWVzLnB1c2gobmV3IFBsYXllcih0aGlzKSk7XG4gICAgICAgIHRoaXMudGljaygpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBkcmF3KCkge1xuICAgICAgICB0aGlzLnNjcmVlbi5jbGVhclJlY3QoMCwgMCwgdGhpcy5nYW1lU2l6ZS54LCB0aGlzLmdhbWVTaXplLnkpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYm9kaWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBVdGlsLmRyYXdSZWN0KHRoaXMuc2NyZWVuLCB0aGlzLmJvZGllc1tpXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgdXBkYXRlKCkge1xuICAgICAgICBsZXQgYm9kaWVzID0gdGhpcy5ib2RpZXM7XG4gICAgICAgIGNvbnN0IG5vdENvbGxpZGluZ1dpdGhBbnl0aGluZyA9IChiMTogQm9keSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGJvZGllcy5maWx0ZXIoKGIyOiBCb2R5KSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFV0aWwuY29sbGlkaW5nKGIxLCBiMik7XG4gICAgICAgICAgICB9KS5sZW5ndGggPT09IDA7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5ib2RpZXMgPSB0aGlzLmJvZGllcy5maWx0ZXIobm90Q29sbGlkaW5nV2l0aEFueXRoaW5nKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJvZGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5ib2RpZXNbaV0udXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgaGFzUGxheWVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ib2RpZXMuZmlsdGVyKChib2R5OiBCb2R5KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYm9keSBpbnN0YW5jZW9mIFBsYXllcjtcbiAgICAgICAgfSkubGVuZ3RoID09PSAxO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBoYXNJbnZhZGVycygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYm9kaWVzLmZpbHRlcigoYm9keTogQm9keSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGJvZHkgaW5zdGFuY2VvZiBJbnZhZGVyO1xuICAgICAgICB9KS5sZW5ndGggPiAwO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBsb3NlR2FtZSgpIHtcbiAgICAgICAgdGhpcy5kaXNwbGF5TWVzc2FnZShcIkdhbWUgT3ZlclwiKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgd2luR2FtZSgpIHtcbiAgICAgICAgdGhpcy5kaXNwbGF5TWVzc2FnZShcIllvdSBXaW4hXCIpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBkaXNwbGF5TWVzc2FnZSh0ZXh0OiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5zY3JlZW4uZm9udCA9IFwiNDhweCBzZXJpZlwiO1xuICAgICAgICB0aGlzLnNjcmVlbi50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xuICAgICAgICB0aGlzLnNjcmVlbi5maWxsVGV4dCh0ZXh0LCB0aGlzLmdhbWVTaXplLnggLyAyLCB0aGlzLmdhbWVTaXplLnkgLyAyKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBCdWxsZXQgfSBmcm9tIFwiLi9idWxsZXRcIjtcbmltcG9ydCB7IEdhbWUgfSBmcm9tIFwiLi9nYW1lXCI7XG5cbmV4cG9ydCBjbGFzcyBJbnZhZGVyIGV4dGVuZHMgQm9keSB7XG4gICAgcHVibGljIHNpemU6IFNpemUgPSB7eDogMTUsIHk6IDE1fTtcbiAgICBwcm90ZWN0ZWQgZ2FtZTogR2FtZTtcbiAgICBwcm90ZWN0ZWQgcGF0cm9sWDogbnVtYmVyO1xuICAgIHByb3RlY3RlZCBzcGVlZFg6IG51bWJlcjtcbiAgICBwcm90ZWN0ZWQgYnVsbGV0Q2hhbmNlOiBudW1iZXIgPSAwLjk5O1xuXG4gICAgY29uc3RydWN0b3IoZ2FtZTogR2FtZSwgY2VudGVyOiBDZW50ZXIpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5nYW1lID0gZ2FtZTtcbiAgICAgICAgdGhpcy5jZW50ZXIgPSBjZW50ZXI7XG4gICAgICAgIHRoaXMucGF0cm9sWCA9IDA7XG4gICAgICAgIHRoaXMuc3BlZWRYID0gMC4zO1xuICAgIH1cblxuICAgIHB1YmxpYyB1cGRhdGUgKCkge1xuICAgICAgICBpZiAodGhpcy5wYXRyb2xYIDwgMCB8fCB0aGlzLnBhdHJvbFggPiA0MCkge1xuICAgICAgICAgICAgdGhpcy5zcGVlZFggPSAtdGhpcy5zcGVlZFg7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jZW50ZXIueCArPSB0aGlzLnNwZWVkWDtcbiAgICAgICAgdGhpcy5wYXRyb2xYICs9IHRoaXMuc3BlZWRYO1xuXG4gICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gdGhpcy5idWxsZXRDaGFuY2UgJiYgIXRoaXMuZ2FtZS5pbnZhZGVyc0JlbG93KHRoaXMpLmxlbmd0aCkge1xuICAgICAgICAgICAgbGV0IGJ1bGxldCA9IG5ldyBCdWxsZXQoXG4gICAgICAgICAgICAgICAgeyB4OiB0aGlzLmNlbnRlci54LCB5OiB0aGlzLmNlbnRlci55ICsgdGhpcy5zaXplLnggLyAyIH0sXG4gICAgICAgICAgICAgICAgeyB4OiBNYXRoLnJhbmRvbSgpIC0gMC41LCB5OiAyIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0aGlzLmdhbWUuYWRkQm9keShidWxsZXQpO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiZXhwb3J0IGNsYXNzIEtleWJvYXJkZXIge1xuICAgIHByb3RlY3RlZCBrZXlTdGF0ZTogQm9vbGVhbltdID0gW107XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5rZXlTdGF0ZVtldmVudC5rZXlDb2RlXSA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmtleVN0YXRlW2V2ZW50LmtleUNvZGVdID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBpc0Rvd24oa2V5Q29kZTogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmtleVN0YXRlW2tleUNvZGVdID09PSB0cnVlO1xuICAgIH1cbn1cbiIsImV4cG9ydCBjb25zdCBLRVlTID0ge1xuICAgIExFRlQ6IDM3LFxuICAgIFI6IDgyLFxuICAgIFJJR0hUOiAzOSxcbiAgICBTUEFDRTogMzIsXG59O1xuIiwiaW1wb3J0IHsgR2FtZSB9IGZyb20gXCIuL2dhbWVcIjtcblxud2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBnYW1lID0gbmV3IEdhbWUoXCJzY3JlZW5cIik7XG4gICAgZ2FtZS5zdGFydCgpO1xufTtcbiIsImltcG9ydCB7IEJ1bGxldCB9IGZyb20gXCIuL2J1bGxldFwiO1xuaW1wb3J0IHsgS2V5Ym9hcmRlciB9IGZyb20gXCIuL2tleWJvYXJkZXJcIjtcbmltcG9ydCB7IEtFWVMgfSBmcm9tIFwiLi9rZXlzXCI7XG5pbXBvcnQgeyBHYW1lIH0gZnJvbSBcIi4vZ2FtZVwiO1xuXG5leHBvcnQgY2xhc3MgUGxheWVyIGV4dGVuZHMgQm9keSB7XG4gICAgcHVibGljIHNpemU6IFNpemUgPSB7eDogMTUsIHk6IDE1fTtcbiAgICBwcm90ZWN0ZWQga2V5Ym9hcmRlcjogS2V5Ym9hcmRlcjtcbiAgICBwcm90ZWN0ZWQgZ2FtZTogR2FtZTtcblxuICAgIGNvbnN0cnVjdG9yKGdhbWU6IEdhbWUpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5nYW1lID0gZ2FtZTtcbiAgICAgICAgdGhpcy5rZXlib2FyZGVyID0gbmV3IEtleWJvYXJkZXIoKTtcbiAgICAgICAgdGhpcy5jZW50ZXIgPSB7eDogdGhpcy5nYW1lLmdhbWVTaXplLnggLyAyLCB5OiB0aGlzLmdhbWUuZ2FtZVNpemUueSAtIHRoaXMuc2l6ZS54fTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdXBkYXRlKCkge1xuICAgICAgICBpZiAodGhpcy5rZXlib2FyZGVyLmlzRG93bihLRVlTLkxFRlQpICYmIHRoaXMuY2VudGVyLnggLSB0aGlzLnNpemUueCAvIDIgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLmNlbnRlci54IC09IDI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5rZXlib2FyZGVyLmlzRG93bihLRVlTLlJJR0hUKSAmJiB0aGlzLmNlbnRlci54ICsgdGhpcy5zaXplLnggLyAyIDwgdGhpcy5nYW1lLmdhbWVTaXplLngpIHtcbiAgICAgICAgICAgIHRoaXMuY2VudGVyLnggKz0gMjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmtleWJvYXJkZXIuaXNEb3duKEtFWVMuU1BBQ0UpKSB7XG4gICAgICAgICAgICBsZXQgYnVsbGV0ID0gbmV3IEJ1bGxldChcbiAgICAgICAgICAgICAgICB7IHg6IHRoaXMuY2VudGVyLngsIHk6IHRoaXMuY2VudGVyLnkgLSB0aGlzLnNpemUueCAvIDIgfSxcbiAgICAgICAgICAgICAgICB7IHg6IDAsIHk6IC02IH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0aGlzLmdhbWUuYWRkQm9keShidWxsZXQpO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgSW52YWRlciB9IGZyb20gXCIuL2ludmFkZXJcIjtcblxuZXhwb3J0IGNsYXNzIFV0aWwge1xuICAgIHB1YmxpYyBzdGF0aWMgcHJvZHVjZUludmFkZXJzKGdhbWU6IGFueSkge1xuICAgICAgICBsZXQgaW52YWRlcnM6IEludmFkZXJbXSA9IFtdO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjQ7IGkrKykge1xuICAgICAgICAgICAgbGV0IHggPSAzMCArIChpICUgOCkgKiAzMDtcbiAgICAgICAgICAgIGxldCB5ID0gMzAgKyAoaSAlIDMpICogMzA7XG4gICAgICAgICAgICBpbnZhZGVycy5wdXNoKG5ldyBJbnZhZGVyKGdhbWUsIHt4OiB4LCB5OiB5fSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGludmFkZXJzO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgY29sbGlkaW5nKGIxOiBCb2R5LCBiMjogQm9keSkge1xuICAgICAgICByZXR1cm4gIShcbiAgICAgICAgICAgIGIxID09PSBiMiB8fFxuICAgICAgICAgICAgYjEuY2VudGVyLnggKyBiMS5zaXplLnggLyAyIDwgYjIuY2VudGVyLnggKyBiMi5zaXplLnggLyAyIHx8XG4gICAgICAgICAgICBiMS5jZW50ZXIueSArIGIxLnNpemUueSAvIDIgPCBiMi5jZW50ZXIueSArIGIyLnNpemUueSAvIDIgfHxcbiAgICAgICAgICAgIGIxLmNlbnRlci54IC0gYjEuc2l6ZS54IC8gMiA+IGIyLmNlbnRlci54ICsgYjIuc2l6ZS54IC8gMiB8fFxuICAgICAgICAgICAgYjEuY2VudGVyLnkgLSBiMS5zaXplLnkgLyAyID4gYjIuY2VudGVyLnkgKyBiMi5zaXplLnkgLyAyXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBkcmF3UmVjdChzY3JlZW46IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgYm9keTogQm9keSkge1xuICAgICAgICBzY3JlZW4uZmlsbFJlY3QoXG4gICAgICAgICAgICBib2R5LmNlbnRlci54IC0gYm9keS5zaXplLnggLyAyLFxuICAgICAgICAgICAgYm9keS5jZW50ZXIueSAtIGJvZHkuc2l6ZS55IC8gMixcbiAgICAgICAgICAgIGJvZHkuc2l6ZS54LFxuICAgICAgICAgICAgYm9keS5zaXplLnlcbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=
