(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Bullet = void 0;
const global_1 = require("./global");
class Bullet extends global_1.Body {
    constructor(center, velocity) {
        super();
        this.size = { x: 3, y: 3 };
        this.center = center;
        this.velocity = velocity;
    }
    update() {
        this.center.x += this.velocity.x;
        this.center.y += this.velocity.y;
    }
}
exports.Bullet = Bullet;
},{"./global":3}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Game = void 0;
const util_1 = require("./util");
const player_1 = require("./player");
const invader_1 = require("./invader");
const keys_1 = require("./keys");
class Game {
    constructor(domId) {
        this.canvas = document.getElementById(domId);
        this.canvas.onclick = this.reset.bind(this);
        this.gameSize = { x: this.canvas.width, y: this.canvas.height };
        this.screen = this.canvas.getContext("2d");
        window.addEventListener("keyup", event => {
            if (event.key === keys_1.KEYS.R) {
                this.reset();
            }
        });
    }
    addBody(body) {
        this.bodies.push(body);
    }
    tick() {
        if (!this.hasPlayer()) {
            this.loseGame();
            return;
        }
        if (!this.hasInvaders()) {
            this.winGame();
            return;
        }
        this.update();
        this.draw();
        this.raf = requestAnimationFrame(this.tick.bind(this));
    }
    invadersBelow(invader) {
        return this.bodies.filter((body) => {
            return (body instanceof invader_1.Invader &&
                body.center.y > invader.center.y &&
                body.center.x - invader.center.x < invader.size.x);
        });
    }
    start() {
        this.reset();
    }
    reset() {
        this.bodies = util_1.Util.produceInvaders(this);
        this.bodies.push(new player_1.Player(this));
        cancelAnimationFrame(this.raf);
        this.tick();
    }
    draw() {
        this.screen.clearRect(0, 0, this.gameSize.x, this.gameSize.y);
        for (let i = 0; i < this.bodies.length; i++) {
            util_1.Util.drawRect(this.screen, this.bodies[i]);
        }
    }
    notCollidingWithAnything(b1) {
        return (this.bodies.filter((b2) => {
            return util_1.Util.colliding(b1, b2);
        }).length === 0);
    }
    ;
    update() {
        this.bodies = this.bodies.filter(this.notCollidingWithAnything.bind(this));
        for (let body of this.bodies) {
            body.update();
        }
    }
    hasPlayer() {
        return (this.bodies.filter((body) => {
            return body instanceof player_1.Player;
        }).length === 1);
    }
    hasInvaders() {
        return (this.bodies.filter((body) => {
            return body instanceof invader_1.Invader;
        }).length > 0);
    }
    loseGame() {
        this.displayMessage("Game Over");
    }
    winGame() {
        this.displayMessage("You win!");
    }
    displayMessage(text) {
        this.screen.font = "48px serif";
        this.screen.textAlign = "center";
        this.screen.fillText(text, this.gameSize.x / 2, this.gameSize.y / 2);
    }
}
exports.Game = Game;
},{"./invader":4,"./keys":6,"./player":8,"./util":9}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Body = exports.Center = exports.Size = exports.Velocity = void 0;
class Velocity {
}
exports.Velocity = Velocity;
class Size {
}
exports.Size = Size;
class Center {
}
exports.Center = Center;
class Body {
}
exports.Body = Body;
},{}],4:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Invader = void 0;
const bullet_1 = require("./bullet");
const global_1 = require("./global");
class Invader extends global_1.Body {
    constructor(game, center) {
        super();
        this.size = { x: 15, y: 15 };
        this.bulletChance = 0.99;
        this.game = game;
        this.center = center;
        this.patrolX = 0;
        this.speedX = 0.3;
    }
    update() {
        if (this.patrolX < 0 || this.patrolX > 40) {
            this.speedX = -this.speedX;
        }
        this.center.x += this.speedX;
        this.patrolX += this.speedX;
        if (Math.random() > this.bulletChance &&
            !this.game.invadersBelow(this).length) {
            let bullet = new bullet_1.Bullet({ x: this.center.x, y: this.center.y + this.size.x / 2 }, { x: Math.random() - 0.5, y: 2 });
            this.game.addBody(bullet);
        }
    }
}
exports.Invader = Invader;
},{"./bullet":1,"./global":3}],5:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Keyboarder = void 0;
class Keyboarder {
    constructor() {
        this.keyState = {};
        window.addEventListener("keydown", event => {
            this.keyState[event.key] = true;
        });
        window.addEventListener("keyup", event => {
            this.keyState[event.key] = false;
        });
    }
    isDown(keyCode) {
        return this.keyState[keyCode] === true;
    }
}
exports.Keyboarder = Keyboarder;
},{}],6:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.KEYS = void 0;
exports.KEYS = {
    LEFT: "ArrowLeft",
    R: "r",
    RIGHT: "ArrowRight",
    SPACE: " "
};
},{}],7:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const game_1 = require("./game");
window.onload = function () {
    const game = new game_1.Game("screen");
    game.start();
};
},{"./game":2}],8:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Player = void 0;
const bullet_1 = require("./bullet");
const keyboarder_1 = require("./keyboarder");
const keys_1 = require("./keys");
const global_1 = require("./global");
class Player extends global_1.Body {
    constructor(game) {
        super();
        this.size = { x: 15, y: 15 };
        this.lastShot = 0;
        this.shotLag = 600;
        this.game = game;
        this.keyboarder = new keyboarder_1.Keyboarder();
        this.center = {
            x: this.game.gameSize.x / 2,
            y: this.game.gameSize.y - this.size.x
        };
    }
    update() {
        if (this.keyboarder.isDown(keys_1.KEYS.LEFT) &&
            this.center.x - this.size.x / 2 > 0) {
            this.center.x -= 2;
        }
        else if (this.keyboarder.isDown(keys_1.KEYS.RIGHT) &&
            this.center.x + this.size.x / 2 < this.game.gameSize.x) {
            this.center.x += 2;
        }
        if (this.keyboarder.isDown(keys_1.KEYS.SPACE)) {
            const now = new Date().getTime();
            if (now - this.lastShot < this.shotLag)
                return;
            this.lastShot = new Date().getTime();
            let bullet = new bullet_1.Bullet({ x: this.center.x, y: this.center.y - this.size.x / 2 }, { x: 0, y: -6 });
            this.game.addBody(bullet);
        }
    }
}
exports.Player = Player;
},{"./bullet":1,"./global":3,"./keyboarder":5,"./keys":6}],9:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Util = void 0;
const invader_1 = require("./invader");
class Util {
    static produceInvaders(game) {
        let invaders = [];
        for (let i = 0; i < 24; i++) {
            let x = 30 + (i % 8) * 30;
            let y = 30 + (i % 3) * 30;
            invaders.push(new invader_1.Invader(game, { x: x, y: y }));
        }
        return invaders;
    }
    static colliding(b1, b2) {
        return !(b1 === b2 ||
            b1.center.x + b1.size.x / 2 < b2.center.x + b2.size.x / 2 ||
            b1.center.y + b1.size.y / 2 < b2.center.y + b2.size.y / 2 ||
            b1.center.x - b1.size.x / 2 > b2.center.x + b2.size.x / 2 ||
            b1.center.y - b1.size.y / 2 > b2.center.y + b2.size.y / 2);
    }
    static drawRect(screen, body) {
        screen.fillRect(body.center.x - body.size.x / 2, body.center.y - body.size.y / 2, body.size.x, body.size.y);
    }
}
exports.Util = Util;
},{"./invader":4}]},{},[7])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYnVsbGV0LnRzIiwic3JjL2dhbWUudHMiLCJzcmMvZ2xvYmFsLnRzIiwic3JjL2ludmFkZXIudHMiLCJzcmMva2V5Ym9hcmRlci50cyIsInNyYy9rZXlzLnRzIiwic3JjL21haW4udHMiLCJzcmMvcGxheWVyLnRzIiwic3JjL3V0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUNBQSxxQ0FBd0Q7QUFFeEQsTUFBYSxNQUFPLFNBQVEsYUFBSTtJQUk5QixZQUFZLE1BQWMsRUFBRSxRQUFrQjtRQUM1QyxLQUFLLEVBQUUsQ0FBQztRQUpILFNBQUksR0FBUyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDO1FBS2pDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0lBQzNCLENBQUM7SUFFTSxNQUFNO1FBQ1gsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDbkMsQ0FBQztDQUNGO0FBZEQsd0JBY0M7Ozs7O0FDaEJELGlDQUE4QjtBQUM5QixxQ0FBa0M7QUFDbEMsdUNBQW9DO0FBQ3BDLGlDQUE4QjtBQUc5QixNQUFhLElBQUk7SUFPZixZQUFZLEtBQWE7UUFDdkIsSUFBSSxDQUFDLE1BQU0sR0FBc0IsUUFBUSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoRSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM1QyxJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUs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RSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUMxRCxDQUFDO0lBQ0osQ0FBQztJQUVNLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBZ0MsRUFBRSxJQUFVO1FBQ2pFLE1BQU0sQ0FBQyxRQUFRLENBQ2IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUMvQixJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQy9CLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUNYLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUNaLENBQUM7SUFDSixDQUFDO0NBQ0Y7QUEvQkQsb0JBK0JDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiaW1wb3J0IHsgQm9keSwgU2l6ZSwgVmVsb2NpdHksIENlbnRlciB9IGZyb20gXCIuL2dsb2JhbFwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEJ1bGxldCBleHRlbmRzIEJvZHkge1xyXG4gIHB1YmxpYyBzaXplOiBTaXplID0geyB4OiAzLCB5OiAzIH07XHJcbiAgcHJvdGVjdGVkIHZlbG9jaXR5OiBWZWxvY2l0eTtcclxuXHJcbiAgY29uc3RydWN0b3IoY2VudGVyOiBDZW50ZXIsIHZlbG9jaXR5OiBWZWxvY2l0eSkge1xyXG4gICAgc3VwZXIoKTtcclxuICAgIHRoaXMuY2VudGVyID0gY2VudGVyO1xyXG4gICAgdGhpcy52ZWxvY2l0eSA9IHZlbG9jaXR5O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHVwZGF0ZSgpIHtcclxuICAgIHRoaXMuY2VudGVyLnggKz0gdGhpcy52ZWxvY2l0eS54O1xyXG4gICAgdGhpcy5jZW50ZXIueSArPSB0aGlzLnZlbG9jaXR5Lnk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IFV0aWwgfSBmcm9tIFwiLi91dGlsXCI7XHJcbmltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuL3BsYXllclwiO1xyXG5pbXBvcnQgeyBJbnZhZGVyIH0gZnJvbSBcIi4vaW52YWRlclwiO1xyXG5pbXBvcnQgeyBLRVlTIH0gZnJvbSBcIi4va2V5c1wiO1xyXG5pbXBvcnQgeyBTaXplLCBCb2R5IH0gZnJvbSBcIi4vZ2xvYmFsXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgR2FtZSB7XHJcbiAgcHVibGljIGdhbWVTaXplOiBTaXplO1xyXG4gIHByb3RlY3RlZCBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xyXG4gIHByb3RlY3RlZCBib2RpZXM6IEJvZHlbXTtcclxuICBwcm90ZWN0ZWQgc2NyZWVuOiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XHJcbiAgcHJvdGVjdGVkIHJhZjogbnVtYmVyO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihkb21JZDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmNhbnZhcyA9IDxIVE1MQ2FudmFzRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChkb21JZCk7XHJcbiAgICB0aGlzLmNhbnZhcy5vbmNsaWNrID0gdGhpcy5yZXNldC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5nYW1lU2l6ZSA9IHsgeDogdGhpcy5jYW52YXMud2lkdGgsIHk6IHRoaXMuY2FudmFzLmhlaWdodCB9O1xyXG4gICAgdGhpcy5zY3JlZW4gPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGV2ZW50ID0+IHtcclxuICAgICAgaWYgKGV2ZW50LmtleSA9PT0gS0VZUy5SKSB7XHJcbiAgICAgICAgdGhpcy5yZXNldCgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhZGRCb2R5KGJvZHk6IEJvZHkpIHtcclxuICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdGljaygpIHtcclxuICAgIGlmICghdGhpcy5oYXNQbGF5ZXIoKSkge1xyXG4gICAgICB0aGlzLmxvc2VHYW1lKCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghdGhpcy5oYXNJbnZhZGVycygpKSB7XHJcbiAgICAgIHRoaXMud2luR2FtZSgpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnVwZGF0ZSgpO1xyXG4gICAgdGhpcy5kcmF3KCk7XHJcblxyXG4gICAgdGhpcy5yYWYgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy50aWNrLmJpbmQodGhpcykpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGludmFkZXJzQmVsb3coaW52YWRlcjogSW52YWRlcikge1xyXG4gICAgcmV0dXJuIHRoaXMuYm9kaWVzLmZpbHRlcigoYm9keTogQm9keSkgPT4ge1xyXG4gICAgICByZXR1cm4gKFxyXG4gICAgICAgIGJvZHkgaW5zdGFuY2VvZiBJbnZhZGVyICYmXHJcbiAgICAgICAgYm9keS5jZW50ZXIueSA+IGludmFkZXIuY2VudGVyLnkgJiZcclxuICAgICAgICBib2R5LmNlbnRlci54IC0gaW52YWRlci5jZW50ZXIueCA8IGludmFkZXIuc2l6ZS54XHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGFydCgpIHtcclxuICAgIHRoaXMucmVzZXQoKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCByZXNldCgpIHtcclxuICAgIHRoaXMuYm9kaWVzID0gVXRpbC5wcm9kdWNlSW52YWRlcnModGhpcyk7XHJcbiAgICB0aGlzLmJvZGllcy5wdXNoKG5ldyBQbGF5ZXIodGhpcykpO1xyXG4gICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUgKHRoaXMucmFmKTtcclxuICAgIHRoaXMudGljaygpO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGRyYXcoKSB7XHJcbiAgICB0aGlzLnNjcmVlbi5jbGVhclJlY3QoMCwgMCwgdGhpcy5nYW1lU2l6ZS54LCB0aGlzLmdhbWVTaXplLnkpO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJvZGllcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBVdGlsLmRyYXdSZWN0KHRoaXMuc2NyZWVuLCB0aGlzLmJvZGllc1tpXSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgbm90Q29sbGlkaW5nV2l0aEFueXRoaW5nKGIxOiBCb2R5KSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICB0aGlzLmJvZGllcy5maWx0ZXIoKGIyOiBCb2R5KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIFV0aWwuY29sbGlkaW5nKGIxLCBiMik7XHJcbiAgICAgIH0pLmxlbmd0aCA9PT0gMFxyXG4gICAgKTtcclxuICB9O1xyXG5cclxuICBwcm90ZWN0ZWQgdXBkYXRlKCkge1xyXG4gICAgdGhpcy5ib2RpZXMgPSB0aGlzLmJvZGllcy5maWx0ZXIodGhpcy5ub3RDb2xsaWRpbmdXaXRoQW55dGhpbmcuYmluZCh0aGlzKSk7XHJcbiAgICBmb3IgKGxldCBib2R5IG9mIHRoaXMuYm9kaWVzKSB7XHJcbiAgICAgIGJvZHkudXBkYXRlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgaGFzUGxheWVyKCkge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgdGhpcy5ib2RpZXMuZmlsdGVyKChib2R5OiBCb2R5KSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGJvZHkgaW5zdGFuY2VvZiBQbGF5ZXI7XHJcbiAgICAgIH0pLmxlbmd0aCA9PT0gMVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBoYXNJbnZhZGVycygpIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIHRoaXMuYm9kaWVzLmZpbHRlcigoYm9keTogQm9keSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBib2R5IGluc3RhbmNlb2YgSW52YWRlcjtcclxuICAgICAgfSkubGVuZ3RoID4gMFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBsb3NlR2FtZSgpIHtcclxuICAgIHRoaXMuZGlzcGxheU1lc3NhZ2UoXCJHYW1lIE92ZXJcIik7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgd2luR2FtZSgpIHtcclxuICAgIHRoaXMuZGlzcGxheU1lc3NhZ2UoXCJZb3Ugd2luIVwiKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBkaXNwbGF5TWVzc2FnZSh0ZXh0OiBzdHJpbmcpIHtcclxuICAgIHRoaXMuc2NyZWVuLmZvbnQgPSBcIjQ4cHggc2VyaWZcIjtcclxuICAgIHRoaXMuc2NyZWVuLnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XHJcbiAgICB0aGlzLnNjcmVlbi5maWxsVGV4dCh0ZXh0LCB0aGlzLmdhbWVTaXplLnggLyAyLCB0aGlzLmdhbWVTaXplLnkgLyAyKTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGNsYXNzIFZlbG9jaXR5IHtcclxuICBwdWJsaWMgeDogbnVtYmVyO1xyXG4gIHB1YmxpYyB5OiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBTaXplIHtcclxuICBwdWJsaWMgeDogbnVtYmVyO1xyXG4gIHB1YmxpYyB5OiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBDZW50ZXIge1xyXG4gIHB1YmxpYyB4OiBudW1iZXI7XHJcbiAgcHVibGljIHk6IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEJvZHkge1xyXG4gIHB1YmxpYyBjZW50ZXI6IENlbnRlcjtcclxuICBwdWJsaWMgc2l6ZTogU2l6ZTtcclxuXHJcbiAgcHVibGljIGFic3RyYWN0IHVwZGF0ZSgpOiB2b2lkO1xyXG59XHJcbiIsImltcG9ydCB7IEJ1bGxldCB9IGZyb20gXCIuL2J1bGxldFwiO1xyXG5pbXBvcnQgeyBHYW1lIH0gZnJvbSBcIi4vZ2FtZVwiO1xyXG5pbXBvcnQgeyBCb2R5LCBTaXplLCBDZW50ZXIgfSBmcm9tIFwiLi9nbG9iYWxcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBJbnZhZGVyIGV4dGVuZHMgQm9keSB7XHJcbiAgcHVibGljIHNpemU6IFNpemUgPSB7IHg6IDE1LCB5OiAxNSB9O1xyXG4gIHByb3RlY3RlZCBnYW1lOiBHYW1lO1xyXG4gIHByb3RlY3RlZCBwYXRyb2xYOiBudW1iZXI7XHJcbiAgcHJvdGVjdGVkIHNwZWVkWDogbnVtYmVyO1xyXG4gIHByb3RlY3RlZCBidWxsZXRDaGFuY2U6IG51bWJlciA9IDAuOTk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGdhbWU6IEdhbWUsIGNlbnRlcjogQ2VudGVyKSB7XHJcbiAgICBzdXBlcigpO1xyXG4gICAgdGhpcy5nYW1lID0gZ2FtZTtcclxuICAgIHRoaXMuY2VudGVyID0gY2VudGVyO1xyXG4gICAgdGhpcy5wYXRyb2xYID0gMDtcclxuICAgIHRoaXMuc3BlZWRYID0gMC4zO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHVwZGF0ZSgpIHtcclxuICAgIGlmICh0aGlzLnBhdHJvbFggPCAwIHx8IHRoaXMucGF0cm9sWCA+IDQwKSB7XHJcbiAgICAgIHRoaXMuc3BlZWRYID0gLXRoaXMuc3BlZWRYO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jZW50ZXIueCArPSB0aGlzLnNwZWVkWDtcclxuICAgIHRoaXMucGF0cm9sWCArPSB0aGlzLnNwZWVkWDtcclxuXHJcbiAgICBpZiAoXHJcbiAgICAgIE1hdGgucmFuZG9tKCkgPiB0aGlzLmJ1bGxldENoYW5jZSAmJlxyXG4gICAgICAhdGhpcy5nYW1lLmludmFkZXJzQmVsb3codGhpcykubGVuZ3RoXHJcbiAgICApIHtcclxuICAgICAgbGV0IGJ1bGxldCA9IG5ldyBCdWxsZXQoXHJcbiAgICAgICAgeyB4OiB0aGlzLmNlbnRlci54LCB5OiB0aGlzLmNlbnRlci55ICsgdGhpcy5zaXplLnggLyAyIH0sXHJcbiAgICAgICAgeyB4OiBNYXRoLnJhbmRvbSgpIC0gMC41LCB5OiAyIH1cclxuICAgICAgKTtcclxuICAgICAgdGhpcy5nYW1lLmFkZEJvZHkoYnVsbGV0KTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiXHJcbmV4cG9ydCBjbGFzcyBLZXlib2FyZGVyIHtcclxuICBwcm90ZWN0ZWQga2V5U3RhdGU6IHtba2V5OiBzdHJpbmddOiBCb29sZWFuIH0gPSB7fTtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZXZlbnQgPT4ge1xyXG4gICAgICB0aGlzLmtleVN0YXRlW2V2ZW50LmtleV0gPSB0cnVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBldmVudCA9PiB7XHJcbiAgICAgIHRoaXMua2V5U3RhdGVbZXZlbnQua2V5XSA9IGZhbHNlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNEb3duKGtleUNvZGU6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHRoaXMua2V5U3RhdGVba2V5Q29kZV0gPT09IHRydWU7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBjb25zdCBLRVlTID0ge1xyXG4gIExFRlQ6IFwiQXJyb3dMZWZ0XCIsXHJcbiAgUjogXCJyXCIsXHJcbiAgUklHSFQ6IFwiQXJyb3dSaWdodFwiLFxyXG4gIFNQQUNFOiBcIiBcIlxyXG59O1xyXG4iLCJpbXBvcnQgeyBHYW1lIH0gZnJvbSBcIi4vZ2FtZVwiO1xyXG5cclxud2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xyXG4gIGNvbnN0IGdhbWUgPSBuZXcgR2FtZShcInNjcmVlblwiKTtcclxuICBnYW1lLnN0YXJ0KCk7XHJcbn07XHJcbiIsImltcG9ydCB7IEJ1bGxldCB9IGZyb20gXCIuL2J1bGxldFwiO1xyXG5pbXBvcnQgeyBLZXlib2FyZGVyIH0gZnJvbSBcIi4va2V5Ym9hcmRlclwiO1xyXG5pbXBvcnQgeyBLRVlTIH0gZnJvbSBcIi4va2V5c1wiO1xyXG5pbXBvcnQgeyBHYW1lIH0gZnJvbSBcIi4vZ2FtZVwiO1xyXG5pbXBvcnQgeyBCb2R5LCBTaXplIH0gZnJvbSBcIi4vZ2xvYmFsXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgUGxheWVyIGV4dGVuZHMgQm9keSB7XHJcbiAgcHVibGljIHNpemU6IFNpemUgPSB7IHg6IDE1LCB5OiAxNSB9O1xyXG4gIHByb3RlY3RlZCBrZXlib2FyZGVyOiBLZXlib2FyZGVyO1xyXG4gIHByb3RlY3RlZCBnYW1lOiBHYW1lO1xyXG4gIHByb3RlY3RlZCBsYXN0U2hvdDogbnVtYmVyID0gMDtcclxuICBwcm90ZWN0ZWQgc2hvdExhZzogbnVtYmVyID0gNjAwO1xyXG5cclxuICBjb25zdHJ1Y3RvcihnYW1lOiBHYW1lKSB7XHJcbiAgICBzdXBlcigpO1xyXG4gICAgdGhpcy5nYW1lID0gZ2FtZTtcclxuICAgIHRoaXMua2V5Ym9hcmRlciA9IG5ldyBLZXlib2FyZGVyKCk7XHJcbiAgICB0aGlzLmNlbnRlciA9IHtcclxuICAgICAgeDogdGhpcy5nYW1lLmdhbWVTaXplLnggLyAyLFxyXG4gICAgICB5OiB0aGlzLmdhbWUuZ2FtZVNpemUueSAtIHRoaXMuc2l6ZS54XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHVwZGF0ZSgpIHtcclxuICAgIGlmIChcclxuICAgICAgdGhpcy5rZXlib2FyZGVyLmlzRG93bihLRVlTLkxFRlQpICYmXHJcbiAgICAgIHRoaXMuY2VudGVyLnggLSB0aGlzLnNpemUueCAvIDIgPiAwXHJcbiAgICApIHtcclxuICAgICAgdGhpcy5jZW50ZXIueCAtPSAyO1xyXG4gICAgfSBlbHNlIGlmIChcclxuICAgICAgdGhpcy5rZXlib2FyZGVyLmlzRG93bihLRVlTLlJJR0hUKSAmJlxyXG4gICAgICB0aGlzLmNlbnRlci54ICsgdGhpcy5zaXplLnggLyAyIDwgdGhpcy5nYW1lLmdhbWVTaXplLnhcclxuICAgICkge1xyXG4gICAgICB0aGlzLmNlbnRlci54ICs9IDI7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMua2V5Ym9hcmRlci5pc0Rvd24oS0VZUy5TUEFDRSkpIHtcclxuICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgIGlmIChub3cgLSB0aGlzLmxhc3RTaG90IDwgdGhpcy5zaG90TGFnKSByZXR1cm47XHJcbiAgICAgIHRoaXMubGFzdFNob3QgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgbGV0IGJ1bGxldCA9IG5ldyBCdWxsZXQoXHJcbiAgICAgICAgeyB4OiB0aGlzLmNlbnRlci54LCB5OiB0aGlzLmNlbnRlci55IC0gdGhpcy5zaXplLnggLyAyIH0sXHJcbiAgICAgICAgeyB4OiAwLCB5OiAtNiB9XHJcbiAgICAgICk7XHJcbiAgICAgIHRoaXMuZ2FtZS5hZGRCb2R5KGJ1bGxldCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IEludmFkZXIgfSBmcm9tIFwiLi9pbnZhZGVyXCI7XHJcbmltcG9ydCB7IEJvZHkgfSBmcm9tIFwiLi9nbG9iYWxcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBVdGlsIHtcclxuICBwdWJsaWMgc3RhdGljIHByb2R1Y2VJbnZhZGVycyhnYW1lOiBhbnkpIHtcclxuICAgIGxldCBpbnZhZGVyczogSW52YWRlcltdID0gW107XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNDsgaSsrKSB7XHJcbiAgICAgIGxldCB4ID0gMzAgKyAoaSAlIDgpICogMzA7XHJcbiAgICAgIGxldCB5ID0gMzAgKyAoaSAlIDMpICogMzA7XHJcbiAgICAgIGludmFkZXJzLnB1c2gobmV3IEludmFkZXIoZ2FtZSwgeyB4OiB4LCB5OiB5IH0pKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaW52YWRlcnM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RhdGljIGNvbGxpZGluZyhiMTogQm9keSwgYjI6IEJvZHkpIHtcclxuICAgIHJldHVybiAhKFxyXG4gICAgICBiMSA9PT0gYjIgfHxcclxuICAgICAgYjEuY2VudGVyLnggKyBiMS5zaXplLnggLyAyIDwgYjIuY2VudGVyLnggKyBiMi5zaXplLnggLyAyIHx8XHJcbiAgICAgIGIxLmNlbnRlci55ICsgYjEuc2l6ZS55IC8gMiA8IGIyLmNlbnRlci55ICsgYjIuc2l6ZS55IC8gMiB8fFxyXG4gICAgICBiMS5jZW50ZXIueCAtIGIxLnNpemUueCAvIDIgPiBiMi5jZW50ZXIueCArIGIyLnNpemUueCAvIDIgfHxcclxuICAgICAgYjEuY2VudGVyLnkgLSBiMS5zaXplLnkgLyAyID4gYjIuY2VudGVyLnkgKyBiMi5zaXplLnkgLyAyXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyBkcmF3UmVjdChzY3JlZW46IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgYm9keTogQm9keSkge1xyXG4gICAgc2NyZWVuLmZpbGxSZWN0KFxyXG4gICAgICBib2R5LmNlbnRlci54IC0gYm9keS5zaXplLnggLyAyLFxyXG4gICAgICBib2R5LmNlbnRlci55IC0gYm9keS5zaXplLnkgLyAyLFxyXG4gICAgICBib2R5LnNpemUueCxcclxuICAgICAgYm9keS5zaXplLnlcclxuICAgICk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
