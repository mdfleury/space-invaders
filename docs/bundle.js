(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
class Bullet {
    constructor(center, velocity) {
        this.size = { x: 3, y: 3 };
        this.center = center;
        this.velocity = velocity;
    }
    update() {
        this.center.x += this.velocity.x;
        this.center.y += this.velocity.y;
    }
}
exports.Bullet = Bullet;

},{}],2:[function(require,module,exports){
"use strict";
const util_1 = require("./util");
const player_1 = require("./player");
const invader_1 = require("./invader");
class Game {
    constructor(domId) {
        this.domId = domId;
        this.canvas = document.getElementById(domId);
        this.canvas.onclick = this.reset.bind(this);
        this.gameSize = { x: this.canvas.width, y: this.canvas.height };
        this.screen = this.canvas.getContext('2d');
        this.reset();
    }
    reset() {
        this.bodies = util_1.Util.produceInvaders(this);
        this.bodies.push(new player_1.Player(this));
        this.tick();
    }
    addBody(body) {
        this.bodies.push(body);
    }
    tick() {
        if (!this.hasPlayer()) {
            this.loseGame();
            return;
        }
        if (!this.hasInvaders()) {
            this.winGame();
            return;
        }
        this.update();
        this.draw();
        requestAnimationFrame(this.tick.bind(this));
    }
    draw() {
        this.screen.clearRect(0, 0, this.gameSize.x, this.gameSize.y);
        for (let i = 0; i < this.bodies.length; i++) {
            util_1.Util.drawRect(this.screen, this.bodies[i]);
        }
    }
    invadersBelow(invader) {
        return this.bodies.filter((body) => {
            return body instanceof invader_1.Invader &&
                body.center.y > invader.center.y &&
                body.center.x - invader.center.x < invader.size.x;
        });
    }
    update() {
        let bodies = this.bodies;
        const notCollidingWithAnything = (b1) => {
            return bodies.filter((b2) => {
                return util_1.Util.colliding(b1, b2);
            }).length === 0;
        };
        this.bodies = this.bodies.filter(notCollidingWithAnything);
        for (let i = 0; i < this.bodies.length; i++) {
            this.bodies[i].update();
        }
    }
    hasPlayer() {
        return this.bodies.filter((body) => {
            return body instanceof player_1.Player;
        }).length === 1;
    }
    hasInvaders() {
        return this.bodies.filter((body) => {
            return body instanceof invader_1.Invader;
        }).length > 0;
    }
    loseGame() {
        this.screen.font = "48px serif";
        this.screen.textAlign = "center";
        this.screen.fillText("Game Over", this.gameSize.x / 2, this.gameSize.y / 2);
    }
    winGame() {
        this.screen.font = "48px serif";
        this.screen.textAlign = "center";
        this.screen.fillText("You Win!", this.gameSize.x / 2, this.gameSize.y / 2);
    }
}
exports.Game = Game;

},{"./invader":3,"./player":6,"./util":7}],3:[function(require,module,exports){
"use strict";
const bullet_1 = require("./bullet");
class Invader {
    constructor(game, center) {
        this.size = { x: 15, y: 15 };
        this.game = game;
        this.center = center;
        this.patrolX = 0;
        this.speedX = 0.3;
    }
    update() {
        if (this.patrolX < 0 || this.patrolX > 40) {
            this.speedX = -this.speedX;
        }
        this.center.x += this.speedX;
        this.patrolX += this.speedX;
        if (Math.random() > 0.99 && !this.game.invadersBelow(this).length) {
            let bullet = new bullet_1.Bullet({ x: this.center.x, y: this.center.y + this.size.x / 2 }, { x: Math.random() - 0.5, y: 2 });
            this.game.addBody(bullet);
        }
    }
}
exports.Invader = Invader;

},{"./bullet":1}],4:[function(require,module,exports){
"use strict";
exports.KEYS = {
    LEFT: 37,
    RIGHT: 39,
    SPACE: 32
};
class Keyboarder {
    constructor() {
        this.keyState = {};
        window.onkeydown = (event) => {
            this.keyState[event.keyCode] = true;
        };
        window.onkeyup = (event) => {
            this.keyState[event.keyCode] = false;
        };
    }
    isDown(keyCode) {
        return this.keyState[keyCode] === true;
    }
}
exports.Keyboarder = Keyboarder;

},{}],5:[function(require,module,exports){
"use strict";
const game_1 = require("./game");
window.onload = function () {
    new game_1.Game('screen');
};

},{"./game":2}],6:[function(require,module,exports){
"use strict";
const bullet_1 = require("./bullet");
const keyboarder_1 = require("./keyboarder");
class Player {
    constructor(game) {
        this.size = { x: 15, y: 15 };
        this.game = game;
        this.keyboarder = new keyboarder_1.Keyboarder();
        this.center = { x: this.game.gameSize.x / 2, y: this.game.gameSize.y - this.size.x };
    }
    update() {
        if (this.keyboarder.isDown(keyboarder_1.KEYS.LEFT)) {
            this.center.x -= 2;
        }
        else if (this.keyboarder.isDown(keyboarder_1.KEYS.RIGHT)) {
            this.center.x += 2;
        }
        else if (this.keyboarder.isDown(keyboarder_1.KEYS.SPACE)) {
            let bullet = new bullet_1.Bullet({ x: this.center.x, y: this.center.y - this.size.x / 2 }, { x: 0, y: -6 });
            this.game.addBody(bullet);
        }
    }
}
exports.Player = Player;

},{"./bullet":1,"./keyboarder":4}],7:[function(require,module,exports){
"use strict";
const invader_1 = require("./invader");
var Util;
(function (Util) {
    function produceInvaders(game) {
        let invaders = [];
        for (let i = 0; i < 24; i++) {
            let x = 30 + (i % 8) * 30;
            let y = 30 + (i % 3) * 30;
            invaders.push(new invader_1.Invader(game, { x: x, y: y }));
        }
        return invaders;
    }
    Util.produceInvaders = produceInvaders;
    ;
    function colliding(b1, b2) {
        return !(b1 === b2 ||
            b1.center.x + b1.size.x / 2 < b2.center.x + b2.size.x / 2 ||
            b1.center.y + b1.size.y / 2 < b2.center.y + b2.size.y / 2 ||
            b1.center.x - b1.size.x / 2 > b2.center.x + b2.size.x / 2 ||
            b1.center.y - b1.size.y / 2 > b2.center.y + b2.size.y / 2);
    }
    Util.colliding = colliding;
    function drawRect(screen, body) {
        screen.fillRect(body.center.x - body.size.x / 2, body.center.y - body.size.y / 2, body.size.x, body.size.y);
    }
    Util.drawRect = drawRect;
    ;
})(Util = exports.Util || (exports.Util = {}));

},{"./invader":3}]},{},[5])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYnVsbGV0LnRzIiwic3JjL2dhbWUudHMiLCJzcmMvaW52YWRlci50cyIsInNyYy9rZXlib2FyZGVyLnRzIiwic3JjL21haW4udHMiLCJzcmMvcGxheWVyLnRzIiwic3JjL3V0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FDT0E7SUFLSSxZQUFZLE1BQWMsRUFBRSxRQUFrQjtRQUg5QyxTQUFJLEdBQVMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQTtRQUlyQixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQTtRQUNwQixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQTtJQUM1QixDQUFDO0lBQ00sTUFBTTtRQUNULElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFBO1FBQ2hDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFBO0lBQ3BDLENBQUM7QUFDTCxDQUFDO0FBYlksY0FBTSxTQWFsQixDQUFBOzs7O0FDbkJELHVCQUFxQixRQUNyQixDQUFDLENBRDRCO0FBQzdCLHlCQUF1QixVQUN2QixDQUFDLENBRGdDO0FBQ2pDLDBCQUF3QixXQUV4QixDQUFDLENBRmtDO0FBRW5DO0lBTUksWUFBbUIsS0FBYTtRQUFiLFVBQUssR0FBTCxLQUFLLENBQVE7UUFDNUIsSUFBSSxDQUFDLE1BQU0sR0FBdUIsUUFBUSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUNoRSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUMzQyxJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUMsQ0FBQyxFQUFFLElBQUksQ0FB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QUFJLENBQUMsSUFBSSxHQUFHLEVBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFDLENBQUE7UUFDMUIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUE7UUFDaEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLHVCQUFVLEVBQUUsQ0FBQTtRQUNsQyxJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBQyxDQUFDO0lBQ3ZGLENBQUM7SUFFRCxNQUFNO1FBQ0YsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsaUJBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZCLENBQUM7UUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsaUJBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDMUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZCLENBQUM7UUFDRCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsaUJBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDMUMsSUFBSSxNQUFNLEdBQUcsSUFBSSxlQUFNLENBQ25CLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEVB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IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiaW1wb3J0IHsgQm9keSwgU2l6ZSwgQ2VudGVyIH0gZnJvbSBcIi4vYm9keVwiXG5cbmRlY2xhcmUgY2xhc3MgVmVsb2NpdHkge1xuICAgIHg6IG51bWJlclxuICAgIHk6IG51bWJlclxufVxuXG5leHBvcnQgY2xhc3MgQnVsbGV0IGltcGxlbWVudHMgQm9keXtcbiAgICB2ZWxvY2l0eTogVmVsb2NpdHlcbiAgICBzaXplOiBTaXplID0ge3g6IDMsIHk6IDN9XG4gICAgY2VudGVyOiBDZW50ZXJcblxuICAgIGNvbnN0cnVjdG9yKGNlbnRlcjogQ2VudGVyLCB2ZWxvY2l0eTogVmVsb2NpdHkpIHtcbiAgICAgICAgdGhpcy5jZW50ZXIgPSBjZW50ZXJcbiAgICAgICAgdGhpcy52ZWxvY2l0eSA9IHZlbG9jaXR5XG4gICAgfVxuICAgIHB1YmxpYyB1cGRhdGUoKSB7XG4gICAgICAgIHRoaXMuY2VudGVyLnggKz0gdGhpcy52ZWxvY2l0eS54XG4gICAgICAgIHRoaXMuY2VudGVyLnkgKz0gdGhpcy52ZWxvY2l0eS55XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgQm9keSwgU2l6ZSB9IGZyb20gXCIuL2JvZHlcIlxuaW1wb3J0IHsgVXRpbCB9IGZyb20gXCIuL3V0aWxcIlxuaW1wb3J0IHsgUGxheWVyIH0gZnJvbSBcIi4vcGxheWVyXCJcbmltcG9ydCB7IEludmFkZXIgfSBmcm9tIFwiLi9pbnZhZGVyXCJcblxuZXhwb3J0IGNsYXNzIEdhbWUge1xuICAgIGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnRcbiAgICBib2RpZXM6IEJvZHlbXVxuICAgIGdhbWVTaXplOiBTaXplXG4gICAgc2NyZWVuOiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkRcblxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBkb21JZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuY2FudmFzID0gPEhUTUxDYW52YXNFbGVtZW50PiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkb21JZClcbiAgICAgICAgdGhpcy5jYW52YXMub25jbGljayA9IHRoaXMucmVzZXQuYmluZCh0aGlzKVxuICAgICAgICB0aGlzLmdhbWVTaXplID0ge3g6IHRoaXMuY2FudmFzLndpZHRoLCB5OiB0aGlzLmNhbnZhcy5oZWlnaHR9XG4gICAgICAgIHRoaXMuc2NyZWVuID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxuICAgICAgICB0aGlzLnJlc2V0KClcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuYm9kaWVzID0gVXRpbC5wcm9kdWNlSW52YWRlcnModGhpcylcbiAgICAgICAgdGhpcy5ib2RpZXMucHVzaChuZXcgUGxheWVyKHRoaXMpKVxuICAgICAgICB0aGlzLnRpY2soKVxuICAgIH1cblxuICAgIHB1YmxpYyBhZGRCb2R5KGJvZHk6IEJvZHkpIHtcbiAgICAgICAgdGhpcy5ib2RpZXMucHVzaChib2R5KVxuICAgIH1cblxuICAgIHB1YmxpYyB0aWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuaGFzUGxheWVyKCkpIHtcbiAgICAgICAgICAgIHRoaXMubG9zZUdhbWUoKVxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmhhc0ludmFkZXJzKCkpIHtcbiAgICAgICAgICAgIHRoaXMud2luR2FtZSgpXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnVwZGF0ZSgpXG4gICAgICAgIHRoaXMuZHJhdygpXG5cbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMudGljay5iaW5kKHRoaXMpKVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBkcmF3KCkge1xuICAgICAgICB0aGlzLnNjcmVlbi5jbGVhclJlY3QoMCwgMCwgdGhpcy5nYW1lU2l6ZS54LCB0aGlzLmdhbWVTaXplLnkpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYm9kaWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBVdGlsLmRyYXdSZWN0KHRoaXMuc2NyZWVuLCB0aGlzLmJvZGllc1tpXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgaW52YWRlcnNCZWxvdyhpbnZhZGVyOiBJbnZhZGVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJvZGllcy5maWx0ZXIoKGJvZHk6IEJvZHkpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBib2R5IGluc3RhbmNlb2YgSW52YWRlciAmJlxuICAgICAgICAgICAgICAgIGJvZHkuY2VudGVyLnkgPiBpbnZhZGVyLmNlbnRlci55ICYmXG4gICAgICAgICAgICAgICAgYm9keS5jZW50ZXIueCAtIGludmFkZXIuY2VudGVyLnggPCBpbnZhZGVyLnNpemUueDtcblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgdXBkYXRlKCkge1xuICAgICAgICBsZXQgYm9kaWVzID0gdGhpcy5ib2RpZXM7XG4gICAgICAgIGNvbnN0IG5vdENvbGxpZGluZ1dpdGhBbnl0aGluZyA9IChiMTogQm9keSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGJvZGllcy5maWx0ZXIoKGIyOiBCb2R5KSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFV0aWwuY29sbGlkaW5nKGIxLCBiMik7XG4gICAgICAgICAgICB9KS5sZW5ndGggPT09IDA7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5ib2RpZXMgPSB0aGlzLmJvZGllcy5maWx0ZXIobm90Q29sbGlkaW5nV2l0aEFueXRoaW5nKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJvZGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5ib2RpZXNbaV0udXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgaGFzUGxheWVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ib2RpZXMuZmlsdGVyKChib2R5OiBCb2R5KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYm9keSBpbnN0YW5jZW9mIFBsYXllcjtcbiAgICAgICAgfSkubGVuZ3RoID09PSAxO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBoYXNJbnZhZGVycygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYm9kaWVzLmZpbHRlcigoYm9keTogQm9keSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGJvZHkgaW5zdGFuY2VvZiBJbnZhZGVyO1xuICAgICAgICB9KS5sZW5ndGggPiAwO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBsb3NlR2FtZSgpIHtcbiAgICAgICAgdGhpcy5zY3JlZW4uZm9udCA9IFwiNDhweCBzZXJpZlwiO1xuICAgICAgICB0aGlzLnNjcmVlbi50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xuICAgICAgICB0aGlzLnNjcmVlbi5maWxsVGV4dChcIkdhbWUgT3ZlclwiLCB0aGlzLmdhbWVTaXplLnggLyAyLCB0aGlzLmdhbWVTaXplLnkgLyAyKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgd2luR2FtZSgpIHtcbiAgICAgICAgdGhpcy5zY3JlZW4uZm9udCA9IFwiNDhweCBzZXJpZlwiO1xuICAgICAgICB0aGlzLnNjcmVlbi50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xuICAgICAgICB0aGlzLnNjcmVlbi5maWxsVGV4dChcIllvdSBXaW4hXCIsIHRoaXMuZ2FtZVNpemUueCAvIDIsIHRoaXMuZ2FtZVNpemUueSAvIDIpO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IEJvZHksIFNpemUsIENlbnRlciB9IGZyb20gXCIuL2JvZHlcIjtcbmltcG9ydCB7IEJ1bGxldCB9IGZyb20gXCIuL2J1bGxldFwiO1xuaW1wb3J0IHsgR2FtZSB9IGZyb20gXCIuL2dhbWVcIjtcblxuZXhwb3J0IGNsYXNzIEludmFkZXIgaW1wbGVtZW50cyBCb2R5IHtcbiAgICBnYW1lOiBhbnlcbiAgICBzaXplOiBTaXplID0ge3g6IDE1LCB5OiAxNX1cbiAgICBjZW50ZXI6IENlbnRlclxuXG4gICAgcGF0cm9sWDogbnVtYmVyXG4gICAgc3BlZWRYOiBudW1iZXJcblxuICAgIGNvbnN0cnVjdG9yKGdhbWU6IEdhbWUsIGNlbnRlcjogQ2VudGVyKSB7XG4gICAgICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG4gICAgICAgIHRoaXMuY2VudGVyID0gY2VudGVyO1xuICAgICAgICB0aGlzLnBhdHJvbFggPSAwO1xuICAgICAgICB0aGlzLnNwZWVkWCA9IDAuMztcbiAgICB9XG5cbiAgICBwdWJsaWMgdXBkYXRlICgpIHtcbiAgICAgICAgaWYgKHRoaXMucGF0cm9sWCA8IDAgfHwgdGhpcy5wYXRyb2xYID4gNDApIHtcbiAgICAgICAgICAgIHRoaXMuc3BlZWRYID0gLXRoaXMuc3BlZWRYO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2VudGVyLnggKz0gdGhpcy5zcGVlZFg7XG4gICAgICAgIHRoaXMucGF0cm9sWCArPSB0aGlzLnNwZWVkWDtcblxuICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA+IDAuOTkgJiYgIXRoaXMuZ2FtZS5pbnZhZGVyc0JlbG93KHRoaXMpLmxlbmd0aCkge1xuICAgICAgICAgICAgbGV0IGJ1bGxldCA9IG5ldyBCdWxsZXQoXG4gICAgICAgICAgICAgICAgeyB4OiB0aGlzLmNlbnRlci54LCB5OiB0aGlzLmNlbnRlci55ICsgdGhpcy5zaXplLnggLyAyIH0sXG4gICAgICAgICAgICAgICAgeyB4OiBNYXRoLnJhbmRvbSgpIC0gMC41LCB5OiAyIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0aGlzLmdhbWUuYWRkQm9keShidWxsZXQpO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiZXhwb3J0IGNvbnN0IEtFWVMgPSB7XG4gICAgTEVGVDogMzcsXG4gICAgUklHSFQ6IDM5LFxuICAgIFNQQUNFOiAzMlxufVxuXG5leHBvcnQgY2xhc3MgS2V5Ym9hcmRlciB7XG4gICAga2V5U3RhdGU6IGFueSA9IHt9XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgd2luZG93Lm9ua2V5ZG93biA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5rZXlTdGF0ZVtldmVudC5rZXlDb2RlXSA9IHRydWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgd2luZG93Lm9ua2V5dXAgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMua2V5U3RhdGVbZXZlbnQua2V5Q29kZV0gPSBmYWxzZTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaXNEb3duKGtleUNvZGU6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gdGhpcy5rZXlTdGF0ZVtrZXlDb2RlXSA9PT0gdHJ1ZTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBHYW1lIH0gZnJvbSBcIi4vZ2FtZVwiO1xuXG53aW5kb3cub25sb2FkID0gZnVuY3Rpb24gKCkge1xuXHRuZXcgR2FtZSgnc2NyZWVuJyk7XG59O1xuIiwiaW1wb3J0IHsgQm9keSwgU2l6ZSwgQ2VudGVyIH0gZnJvbSBcIi4vYm9keVwiO1xuaW1wb3J0IHsgQnVsbGV0IH0gZnJvbSBcIi4vYnVsbGV0XCI7XG5pbXBvcnQgeyBLRVlTLCBLZXlib2FyZGVyIH0gZnJvbSBcIi4va2V5Ym9hcmRlclwiO1xuaW1wb3J0IHsgR2FtZSB9IGZyb20gXCIuL2dhbWVcIlxuXG5leHBvcnQgY2xhc3MgUGxheWVyIGltcGxlbWVudHMgQm9keSB7XG4gICAga2V5Ym9hcmRlcjogS2V5Ym9hcmRlclxuICAgIGdhbWU6IEdhbWVcbiAgICBjZW50ZXI6IENlbnRlclxuICAgIHNpemU6IFNpemVcblxuICAgIGNvbnN0cnVjdG9yKGdhbWU6IEdhbWUpIHtcbiAgICAgICAgdGhpcy5zaXplID0ge3g6IDE1LCB5OiAxNX1cbiAgICAgICAgdGhpcy5nYW1lID0gZ2FtZVxuICAgICAgICB0aGlzLmtleWJvYXJkZXIgPSBuZXcgS2V5Ym9hcmRlcigpXG4gICAgICAgIHRoaXMuY2VudGVyID0ge3g6IHRoaXMuZ2FtZS5nYW1lU2l6ZS54IC8gMiwgeTogdGhpcy5nYW1lLmdhbWVTaXplLnkgLSB0aGlzLnNpemUueH07XG4gICAgfVxuXG4gICAgdXBkYXRlKCkge1xuICAgICAgICBpZiAodGhpcy5rZXlib2FyZGVyLmlzRG93bihLRVlTLkxFRlQpKSB7XG4gICAgICAgICAgICB0aGlzLmNlbnRlci54IC09IDI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5rZXlib2FyZGVyLmlzRG93bihLRVlTLlJJR0hUKSkge1xuICAgICAgICAgICAgdGhpcy5jZW50ZXIueCArPSAyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMua2V5Ym9hcmRlci5pc0Rvd24oS0VZUy5TUEFDRSkpIHtcbiAgICAgICAgICAgIGxldCBidWxsZXQgPSBuZXcgQnVsbGV0KFxuICAgICAgICAgICAgICAgIHsgeDogdGhpcy5jZW50ZXIueCwgeTogdGhpcy5jZW50ZXIueSAtIHRoaXMuc2l6ZS54IC8gMiB9LFxuICAgICAgICAgICAgICAgIHsgeDogMCwgeTogLTYgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMuZ2FtZS5hZGRCb2R5KGJ1bGxldCk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCJpbXBvcnQgeyBCb2R5IH0gZnJvbSBcIi4vYm9keVwiO1xuaW1wb3J0IHsgSW52YWRlciB9IGZyb20gXCIuL2ludmFkZXJcIjtcblxuZXhwb3J0IG1vZHVsZSBVdGlsIHtcbiAgICBleHBvcnQgZnVuY3Rpb24gcHJvZHVjZUludmFkZXJzKGdhbWU6IGFueSkge1xuICAgICAgICBsZXQgaW52YWRlcnM6IEludmFkZXJbXSA9IFtdO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjQ7IGkrKykge1xuICAgICAgICAgICAgbGV0IHggPSAzMCArIChpICUgOCkgKiAzMDtcbiAgICAgICAgICAgIGxldCB5ID0gMzAgKyAoaSAlIDMpICogMzA7XG4gICAgICAgICAgICBpbnZhZGVycy5wdXNoKG5ldyBJbnZhZGVyKGdhbWUsIHt4OiB4LCB5OiB5fSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGludmFkZXJzO1xuICAgIH07XG4gICAgZXhwb3J0IGZ1bmN0aW9uIGNvbGxpZGluZyhiMTogQm9keSwgYjI6IEJvZHkpIHtcbiAgICAgICAgcmV0dXJuICEoXG4gICAgICAgICAgICBiMSA9PT0gYjIgfHxcbiAgICAgICAgICAgIGIxLmNlbnRlci54ICsgYjEuc2l6ZS54IC8gMiA8IGIyLmNlbnRlci54ICsgYjIuc2l6ZS54IC8gMiB8fFxuICAgICAgICAgICAgYjEuY2VudGVyLnkgKyBiMS5zaXplLnkgLyAyIDwgYjIuY2VudGVyLnkgKyBiMi5zaXplLnkgLyAyIHx8XG4gICAgICAgICAgICBiMS5jZW50ZXIueCAtIGIxLnNpemUueCAvIDIgPiBiMi5jZW50ZXIueCArIGIyLnNpemUueCAvIDIgfHxcbiAgICAgICAgICAgIGIxLmNlbnRlci55IC0gYjEuc2l6ZS55IC8gMiA+IGIyLmNlbnRlci55ICsgYjIuc2l6ZS55IC8gMlxuICAgICAgICApO1xuICAgIH1cbiAgICBleHBvcnQgZnVuY3Rpb24gZHJhd1JlY3Qoc2NyZWVuOiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIGJvZHk6IEJvZHkpIHtcbiAgICAgICAgc2NyZWVuLmZpbGxSZWN0KFxuICAgICAgICAgICAgYm9keS5jZW50ZXIueCAtIGJvZHkuc2l6ZS54IC8gMixcbiAgICAgICAgICAgIGJvZHkuY2VudGVyLnkgLSBib2R5LnNpemUueSAvIDIsXG4gICAgICAgICAgICBib2R5LnNpemUueCxcbiAgICAgICAgICAgIGJvZHkuc2l6ZS55XG4gICAgICAgICk7XG4gICAgfTtcbn1cbiJdfQ==
