(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const global_1 = require("./global");
class Bullet extends global_1.Body {
    constructor(center, velocity) {
        super();
        this.size = { x: 3, y: 3 };
        this.center = center;
        this.velocity = velocity;
    }
    update() {
        this.center.x += this.velocity.x;
        this.center.y += this.velocity.y;
    }
}
exports.Bullet = Bullet;

},{"./global":3}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const util_1 = require("./util");
const player_1 = require("./player");
const invader_1 = require("./invader");
const keys_1 = require("./keys");
class Game {
    constructor(domId) {
        this.canvas = document.getElementById(domId);
        this.canvas.onclick = this.reset.bind(this);
        this.gameSize = { x: this.canvas.width, y: this.canvas.height };
        this.screen = this.canvas.getContext("2d");
        window.addEventListener("keyup", event => {
            if (event.keyCode === keys_1.KEYS.R) {
                this.reset();
            }
        });
    }
    addBody(body) {
        this.bodies.push(body);
    }
    tick() {
        if (!this.hasPlayer()) {
            this.loseGame();
            return;
        }
        if (!this.hasInvaders()) {
            this.winGame();
            return;
        }
        this.update();
        this.draw();
        requestAnimationFrame(this.tick.bind(this));
    }
    invadersBelow(invader) {
        return this.bodies.filter((body) => {
            return (body instanceof invader_1.Invader &&
                body.center.y > invader.center.y &&
                body.center.x - invader.center.x < invader.size.x);
        });
    }
    start() {
        this.reset();
    }
    reset() {
        this.bodies = util_1.Util.produceInvaders(this);
        this.bodies.push(new player_1.Player(this));
        this.tick();
    }
    draw() {
        this.screen.clearRect(0, 0, this.gameSize.x, this.gameSize.y);
        for (let i = 0; i < this.bodies.length; i++) {
            util_1.Util.drawRect(this.screen, this.bodies[i]);
        }
    }
    update() {
        let bodies = this.bodies;
        const notCollidingWithAnything = (b1) => {
            return (bodies.filter((b2) => {
                return util_1.Util.colliding(b1, b2);
            }).length === 0);
        };
        this.bodies = this.bodies.filter(notCollidingWithAnything);
        for (let i = 0; i < this.bodies.length; i++) {
            this.bodies[i].update();
        }
    }
    hasPlayer() {
        return (this.bodies.filter((body) => {
            return body instanceof player_1.Player;
        }).length === 1);
    }
    hasInvaders() {
        return (this.bodies.filter((body) => {
            return body instanceof invader_1.Invader;
        }).length > 0);
    }
    loseGame() {
        this.displayMessage("Game Over");
    }
    winGame() {
        this.displayMessage("You win!");
    }
    displayMessage(text) {
        this.screen.font = "48px serif";
        this.screen.textAlign = "center";
        this.screen.fillText(text, this.gameSize.x / 2, this.gameSize.y / 2);
    }
}
exports.Game = Game;

},{"./invader":4,"./keys":6,"./player":8,"./util":9}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Velocity {
}
exports.Velocity = Velocity;
class Size {
}
exports.Size = Size;
class Center {
}
exports.Center = Center;
class Body {
}
exports.Body = Body;

},{}],4:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const bullet_1 = require("./bullet");
const global_1 = require("./global");
class Invader extends global_1.Body {
    constructor(game, center) {
        super();
        this.size = { x: 15, y: 15 };
        this.bulletChance = 0.99;
        this.game = game;
        this.center = center;
        this.patrolX = 0;
        this.speedX = 0.3;
    }
    update() {
        if (this.patrolX < 0 || this.patrolX > 40) {
            this.speedX = -this.speedX;
        }
        this.center.x += this.speedX;
        this.patrolX += this.speedX;
        if (Math.random() > this.bulletChance &&
            !this.game.invadersBelow(this).length) {
            let bullet = new bullet_1.Bullet({ x: this.center.x, y: this.center.y + this.size.x / 2 }, { x: Math.random() - 0.5, y: 2 });
            this.game.addBody(bullet);
        }
    }
}
exports.Invader = Invader;

},{"./bullet":1,"./global":3}],5:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Keyboarder {
    constructor() {
        this.keyState = [];
        window.addEventListener("keydown", event => {
            this.keyState[event.keyCode] = true;
        });
        window.addEventListener("keyup", event => {
            this.keyState[event.keyCode] = false;
        });
    }
    isDown(keyCode) {
        return this.keyState[keyCode] === true;
    }
}
exports.Keyboarder = Keyboarder;

},{}],6:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.KEYS = {
    LEFT: 37,
    R: 82,
    RIGHT: 39,
    SPACE: 32
};

},{}],7:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const game_1 = require("./game");
window.onload = function () {
    const game = new game_1.Game("screen");
    game.start();
};

},{"./game":2}],8:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const bullet_1 = require("./bullet");
const keyboarder_1 = require("./keyboarder");
const keys_1 = require("./keys");
const global_1 = require("./global");
class Player extends global_1.Body {
    constructor(game) {
        super();
        this.size = { x: 15, y: 15 };
        this.lastShot = 0;
        this.shotLag = 100;
        this.game = game;
        this.keyboarder = new keyboarder_1.Keyboarder();
        this.center = {
            x: this.game.gameSize.x / 2,
            y: this.game.gameSize.y - this.size.x
        };
    }
    update() {
        if (this.keyboarder.isDown(keys_1.KEYS.LEFT) &&
            this.center.x - this.size.x / 2 > 0) {
            this.center.x -= 2;
        }
        else if (this.keyboarder.isDown(keys_1.KEYS.RIGHT) &&
            this.center.x + this.size.x / 2 < this.game.gameSize.x) {
            this.center.x += 2;
        }
        if (this.keyboarder.isDown(keys_1.KEYS.SPACE)) {
            const now = new Date().getTime();
            if (now - this.lastShot < this.shotLag)
                return;
            this.lastShot = new Date().getTime();
            let bullet = new bullet_1.Bullet({ x: this.center.x, y: this.center.y - this.size.x / 2 }, { x: 0, y: -6 });
            this.game.addBody(bullet);
        }
    }
}
exports.Player = Player;

},{"./bullet":1,"./global":3,"./keyboarder":5,"./keys":6}],9:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const invader_1 = require("./invader");
class Util {
    static produceInvaders(game) {
        let invaders = [];
        for (let i = 0; i < 24; i++) {
            let x = 30 + (i % 8) * 30;
            let y = 30 + (i % 3) * 30;
            invaders.push(new invader_1.Invader(game, { x: x, y: y }));
        }
        return invaders;
    }
    static colliding(b1, b2) {
        return !(b1 === b2 ||
            b1.center.x + b1.size.x / 2 < b2.center.x + b2.size.x / 2 ||
            b1.center.y + b1.size.y / 2 < b2.center.y + b2.size.y / 2 ||
            b1.center.x - b1.size.x / 2 > b2.center.x + b2.size.x / 2 ||
            b1.center.y - b1.size.y / 2 > b2.center.y + b2.size.y / 2);
    }
    static drawRect(screen, body) {
        screen.fillRect(body.center.x - body.size.x / 2, body.center.y - body.size.y / 2, body.size.x, body.size.y);
    }
}
exports.Util = Util;

},{"./invader":4}]},{},[7])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYnVsbGV0LnRzIiwic3JjL2dhbWUudHMiLCJzcmMvZ2xvYmFsLnRzIiwic3JjL2ludmFkZXIudHMiLCJzcmMva2V5Ym9hcmRlci50cyIsInNyYy9rZXlzLnRzIiwic3JjL21haW4udHMiLCJzcmMvcGxheWVyLnRzIiwic3JjL3V0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBLHFDQUF3RDtBQUV4RCxNQUFhLE1BQU8sU0FBUSxhQUFJO0lBSTlCLFlBQVksTUFBYyxFQUFFLFFBQWtCO1FBQzVDLEtBQUssRUFBRSxDQUFDO1FBSkgsU0FBSSxHQUFTLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFLakMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7SUFDM0IsQ0FBQztJQUVNLE1BQU07UUFDWCxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUNuQyxDQUFDO0NBQ0Y7QUFkRCx3QkFjQzs7Ozs7QUNoQkQsaUNBQThCO0FBQzlCLHFDQUFrQztBQUNsQyx1Q0FBb0M7QUFDcEMsaUNBQThCO0FBRzlCLE1BQWEsSUFBSTtJQU1mLFlBQVksS0FBYTtRQUN2QixJQUFJLENBQUMsTUFBTSxHQUFzQixRQUFRLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hFLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVDLElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxD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QUFHLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQzFELENBQUM7SUFDSixDQUFDO0lBRU0sTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFnQyxFQUFFLElBQVU7UUFDakUsTUFBTSxDQUFDLFFBQVEsQ0FDYixJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQy9CLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFDL0IsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQ1osQ0FBQztJQUNKLENBQUM7Q0FDRjtBQS9CRCxvQkErQkMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJpbXBvcnQgeyBCb2R5LCBTaXplLCBWZWxvY2l0eSwgQ2VudGVyIH0gZnJvbSBcIi4vZ2xvYmFsXCI7XG5cbmV4cG9ydCBjbGFzcyBCdWxsZXQgZXh0ZW5kcyBCb2R5IHtcbiAgcHVibGljIHNpemU6IFNpemUgPSB7IHg6IDMsIHk6IDMgfTtcbiAgcHJvdGVjdGVkIHZlbG9jaXR5OiBWZWxvY2l0eTtcblxuICBjb25zdHJ1Y3RvcihjZW50ZXI6IENlbnRlciwgdmVsb2NpdHk6IFZlbG9jaXR5KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmNlbnRlciA9IGNlbnRlcjtcbiAgICB0aGlzLnZlbG9jaXR5ID0gdmVsb2NpdHk7XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlKCkge1xuICAgIHRoaXMuY2VudGVyLnggKz0gdGhpcy52ZWxvY2l0eS54O1xuICAgIHRoaXMuY2VudGVyLnkgKz0gdGhpcy52ZWxvY2l0eS55O1xuICB9XG59XG4iLCJpbXBvcnQgeyBVdGlsIH0gZnJvbSBcIi4vdXRpbFwiO1xuaW1wb3J0IHsgUGxheWVyIH0gZnJvbSBcIi4vcGxheWVyXCI7XG5pbXBvcnQgeyBJbnZhZGVyIH0gZnJvbSBcIi4vaW52YWRlclwiO1xuaW1wb3J0IHsgS0VZUyB9IGZyb20gXCIuL2tleXNcIjtcbmltcG9ydCB7IFNpemUsIEJvZHkgfSBmcm9tIFwiLi9nbG9iYWxcIjtcblxuZXhwb3J0IGNsYXNzIEdhbWUge1xuICBwdWJsaWMgZ2FtZVNpemU6IFNpemU7XG4gIHByb3RlY3RlZCBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xuICBwcm90ZWN0ZWQgYm9kaWVzOiBCb2R5W107XG4gIHByb3RlY3RlZCBzY3JlZW46IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcblxuICBjb25zdHJ1Y3Rvcihkb21JZDogc3RyaW5nKSB7XG4gICAgdGhpcy5jYW52YXMgPSA8SFRNTENhbnZhc0VsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZG9tSWQpO1xuICAgIHRoaXMuY2FudmFzLm9uY2xpY2sgPSB0aGlzLnJlc2V0LmJpbmQodGhpcyk7XG4gICAgdGhpcy5nYW1lU2l6ZSA9IHsgeDogdGhpcy5jYW52YXMud2lkdGgsIHk6IHRoaXMuY2FudmFzLmhlaWdodCB9O1xuICAgIHRoaXMuc2NyZWVuID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgZXZlbnQgPT4ge1xuICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuUikge1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgYWRkQm9keShib2R5OiBCb2R5KSB7XG4gICAgdGhpcy5ib2RpZXMucHVzaChib2R5KTtcbiAgfVxuXG4gIHB1YmxpYyB0aWNrKCkge1xuICAgIGlmICghdGhpcy5oYXNQbGF5ZXIoKSkge1xuICAgICAgdGhpcy5sb3NlR2FtZSgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuaGFzSW52YWRlcnMoKSkge1xuICAgICAgdGhpcy53aW5HYW1lKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMudXBkYXRlKCk7XG4gICAgdGhpcy5kcmF3KCk7XG5cbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy50aWNrLmJpbmQodGhpcykpO1xuICB9XG5cbiAgcHVibGljIGludmFkZXJzQmVsb3coaW52YWRlcjogSW52YWRlcikge1xuICAgIHJldHVybiB0aGlzLmJvZGllcy5maWx0ZXIoKGJvZHk6IEJvZHkpID0+IHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIGJvZHkgaW5zdGFuY2VvZiBJbnZhZGVyICYmXG4gICAgICAgIGJvZHkuY2VudGVyLnkgPiBpbnZhZGVyLmNlbnRlci55ICYmXG4gICAgICAgIGJvZHkuY2VudGVyLnggLSBpbnZhZGVyLmNlbnRlci54IDwgaW52YWRlci5zaXplLnhcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc3RhcnQoKSB7XG4gICAgdGhpcy5yZXNldCgpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHJlc2V0KCkge1xuICAgIHRoaXMuYm9kaWVzID0gVXRpbC5wcm9kdWNlSW52YWRlcnModGhpcyk7XG4gICAgdGhpcy5ib2RpZXMucHVzaChuZXcgUGxheWVyKHRoaXMpKTtcbiAgICB0aGlzLnRpY2soKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBkcmF3KCkge1xuICAgIHRoaXMuc2NyZWVuLmNsZWFyUmVjdCgwLCAwLCB0aGlzLmdhbWVTaXplLngsIHRoaXMuZ2FtZVNpemUueSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJvZGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgVXRpbC5kcmF3UmVjdCh0aGlzLnNjcmVlbiwgdGhpcy5ib2RpZXNbaV0pO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCB1cGRhdGUoKSB7XG4gICAgbGV0IGJvZGllcyA9IHRoaXMuYm9kaWVzO1xuICAgIGNvbnN0IG5vdENvbGxpZGluZ1dpdGhBbnl0aGluZyA9IChiMTogQm9keSkgPT4ge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgYm9kaWVzLmZpbHRlcigoYjI6IEJvZHkpID0+IHtcbiAgICAgICAgICByZXR1cm4gVXRpbC5jb2xsaWRpbmcoYjEsIGIyKTtcbiAgICAgICAgfSkubGVuZ3RoID09PSAwXG4gICAgICApO1xuICAgIH07XG5cbiAgICB0aGlzLmJvZGllcyA9IHRoaXMuYm9kaWVzLmZpbHRlcihub3RDb2xsaWRpbmdXaXRoQW55dGhpbmcpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5ib2RpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMuYm9kaWVzW2ldLnVwZGF0ZSgpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBoYXNQbGF5ZXIoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuYm9kaWVzLmZpbHRlcigoYm9keTogQm9keSkgPT4ge1xuICAgICAgICByZXR1cm4gYm9keSBpbnN0YW5jZW9mIFBsYXllcjtcbiAgICAgIH0pLmxlbmd0aCA9PT0gMVxuICAgICk7XG4gIH1cblxuICBwcm90ZWN0ZWQgaGFzSW52YWRlcnMoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuYm9kaWVzLmZpbHRlcigoYm9keTogQm9keSkgPT4ge1xuICAgICAgICByZXR1cm4gYm9keSBpbnN0YW5jZW9mIEludmFkZXI7XG4gICAgICB9KS5sZW5ndGggPiAwXG4gICAgKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBsb3NlR2FtZSgpIHtcbiAgICB0aGlzLmRpc3BsYXlNZXNzYWdlKFwiR2FtZSBPdmVyXCIpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHdpbkdhbWUoKSB7XG4gICAgdGhpcy5kaXNwbGF5TWVzc2FnZShcIllvdSB3aW4hXCIpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGRpc3BsYXlNZXNzYWdlKHRleHQ6IHN0cmluZykge1xuICAgIHRoaXMuc2NyZWVuLmZvbnQgPSBcIjQ4cHggc2VyaWZcIjtcbiAgICB0aGlzLnNjcmVlbi50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xuICAgIHRoaXMuc2NyZWVuLmZpbGxUZXh0KHRleHQsIHRoaXMuZ2FtZVNpemUueCAvIDIsIHRoaXMuZ2FtZVNpemUueSAvIDIpO1xuICB9XG59XG4iLCJleHBvcnQgY2xhc3MgVmVsb2NpdHkge1xuICBwdWJsaWMgeDogbnVtYmVyO1xuICBwdWJsaWMgeTogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgU2l6ZSB7XG4gIHB1YmxpYyB4OiBudW1iZXI7XG4gIHB1YmxpYyB5OiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBDZW50ZXIge1xuICBwdWJsaWMgeDogbnVtYmVyO1xuICBwdWJsaWMgeTogbnVtYmVyO1xufVxuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQm9keSB7XG4gIHB1YmxpYyBjZW50ZXI6IENlbnRlcjtcbiAgcHVibGljIHNpemU6IFNpemU7XG5cbiAgcHVibGljIGFic3RyYWN0IHVwZGF0ZSgpOiB2b2lkO1xufVxuIiwiaW1wb3J0IHsgQnVsbGV0IH0gZnJvbSBcIi4vYnVsbGV0XCI7XG5pbXBvcnQgeyBHYW1lIH0gZnJvbSBcIi4vZ2FtZVwiO1xuaW1wb3J0IHsgQm9keSwgU2l6ZSwgQ2VudGVyIH0gZnJvbSBcIi4vZ2xvYmFsXCI7XG5cbmV4cG9ydCBjbGFzcyBJbnZhZGVyIGV4dGVuZHMgQm9keSB7XG4gIHB1YmxpYyBzaXplOiBTaXplID0geyB4OiAxNSwgeTogMTUgfTtcbiAgcHJvdGVjdGVkIGdhbWU6IEdhbWU7XG4gIHByb3RlY3RlZCBwYXRyb2xYOiBudW1iZXI7XG4gIHByb3RlY3RlZCBzcGVlZFg6IG51bWJlcjtcbiAgcHJvdGVjdGVkIGJ1bGxldENoYW5jZTogbnVtYmVyID0gMC45OTtcblxuICBjb25zdHJ1Y3RvcihnYW1lOiBHYW1lLCBjZW50ZXI6IENlbnRlcikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5nYW1lID0gZ2FtZTtcbiAgICB0aGlzLmNlbnRlciA9IGNlbnRlcjtcbiAgICB0aGlzLnBhdHJvbFggPSAwO1xuICAgIHRoaXMuc3BlZWRYID0gMC4zO1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZSgpIHtcbiAgICBpZiAodGhpcy5wYXRyb2xYIDwgMCB8fCB0aGlzLnBhdHJvbFggPiA0MCkge1xuICAgICAgdGhpcy5zcGVlZFggPSAtdGhpcy5zcGVlZFg7XG4gICAgfVxuICAgIHRoaXMuY2VudGVyLnggKz0gdGhpcy5zcGVlZFg7XG4gICAgdGhpcy5wYXRyb2xYICs9IHRoaXMuc3BlZWRYO1xuXG4gICAgaWYgKFxuICAgICAgTWF0aC5yYW5kb20oKSA+IHRoaXMuYnVsbGV0Q2hhbmNlICYmXG4gICAgICAhdGhpcy5nYW1lLmludmFkZXJzQmVsb3codGhpcykubGVuZ3RoXG4gICAgKSB7XG4gICAgICBsZXQgYnVsbGV0ID0gbmV3IEJ1bGxldChcbiAgICAgICAgeyB4OiB0aGlzLmNlbnRlci54LCB5OiB0aGlzLmNlbnRlci55ICsgdGhpcy5zaXplLnggLyAyIH0sXG4gICAgICAgIHsgeDogTWF0aC5yYW5kb20oKSAtIDAuNSwgeTogMiB9XG4gICAgICApO1xuICAgICAgdGhpcy5nYW1lLmFkZEJvZHkoYnVsbGV0KTtcbiAgICB9XG4gIH1cbn1cbiIsImV4cG9ydCBjbGFzcyBLZXlib2FyZGVyIHtcbiAgcHJvdGVjdGVkIGtleVN0YXRlOiBCb29sZWFuW10gPSBbXTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZXZlbnQgPT4ge1xuICAgICAgdGhpcy5rZXlTdGF0ZVtldmVudC5rZXlDb2RlXSA9IHRydWU7XG4gICAgfSk7XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGV2ZW50ID0+IHtcbiAgICAgIHRoaXMua2V5U3RhdGVbZXZlbnQua2V5Q29kZV0gPSBmYWxzZTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBpc0Rvd24oa2V5Q29kZTogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHRoaXMua2V5U3RhdGVba2V5Q29kZV0gPT09IHRydWU7XG4gIH1cbn1cbiIsImV4cG9ydCBjb25zdCBLRVlTID0ge1xuICBMRUZUOiAzNyxcbiAgUjogODIsXG4gIFJJR0hUOiAzOSxcbiAgU1BBQ0U6IDMyXG59O1xuIiwiaW1wb3J0IHsgR2FtZSB9IGZyb20gXCIuL2dhbWVcIjtcblxud2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICBjb25zdCBnYW1lID0gbmV3IEdhbWUoXCJzY3JlZW5cIik7XG4gIGdhbWUuc3RhcnQoKTtcbn07XG4iLCJpbXBvcnQgeyBCdWxsZXQgfSBmcm9tIFwiLi9idWxsZXRcIjtcbmltcG9ydCB7IEtleWJvYXJkZXIgfSBmcm9tIFwiLi9rZXlib2FyZGVyXCI7XG5pbXBvcnQgeyBLRVlTIH0gZnJvbSBcIi4va2V5c1wiO1xuaW1wb3J0IHsgR2FtZSB9IGZyb20gXCIuL2dhbWVcIjtcbmltcG9ydCB7IEJvZHksIFNpemUgfSBmcm9tIFwiLi9nbG9iYWxcIjtcblxuZXhwb3J0IGNsYXNzIFBsYXllciBleHRlbmRzIEJvZHkge1xuICBwdWJsaWMgc2l6ZTogU2l6ZSA9IHsgeDogMTUsIHk6IDE1IH07XG4gIHByb3RlY3RlZCBrZXlib2FyZGVyOiBLZXlib2FyZGVyO1xuICBwcm90ZWN0ZWQgZ2FtZTogR2FtZTtcbiAgcHJvdGVjdGVkIGxhc3RTaG90OiBudW1iZXIgPSAwO1xuICBwcm90ZWN0ZWQgc2hvdExhZzogbnVtYmVyID0gMTAwO1xuXG4gIGNvbnN0cnVjdG9yKGdhbWU6IEdhbWUpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuZ2FtZSA9IGdhbWU7XG4gICAgdGhpcy5rZXlib2FyZGVyID0gbmV3IEtleWJvYXJkZXIoKTtcbiAgICB0aGlzLmNlbnRlciA9IHtcbiAgICAgIHg6IHRoaXMuZ2FtZS5nYW1lU2l6ZS54IC8gMixcbiAgICAgIHk6IHRoaXMuZ2FtZS5nYW1lU2l6ZS55IC0gdGhpcy5zaXplLnhcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZSgpIHtcbiAgICBpZiAoXG4gICAgICB0aGlzLmtleWJvYXJkZXIuaXNEb3duKEtFWVMuTEVGVCkgJiZcbiAgICAgIHRoaXMuY2VudGVyLnggLSB0aGlzLnNpemUueCAvIDIgPiAwXG4gICAgKSB7XG4gICAgICB0aGlzLmNlbnRlci54IC09IDI7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIHRoaXMua2V5Ym9hcmRlci5pc0Rvd24oS0VZUy5SSUdIVCkgJiZcbiAgICAgIHRoaXMuY2VudGVyLnggKyB0aGlzLnNpemUueCAvIDIgPCB0aGlzLmdhbWUuZ2FtZVNpemUueFxuICAgICkge1xuICAgICAgdGhpcy5jZW50ZXIueCArPSAyO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmtleWJvYXJkZXIuaXNEb3duKEtFWVMuU1BBQ0UpKSB7XG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgIGlmIChub3cgLSB0aGlzLmxhc3RTaG90IDwgdGhpcy5zaG90TGFnKSByZXR1cm47XG4gICAgICB0aGlzLmxhc3RTaG90ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICBsZXQgYnVsbGV0ID0gbmV3IEJ1bGxldChcbiAgICAgICAgeyB4OiB0aGlzLmNlbnRlci54LCB5OiB0aGlzLmNlbnRlci55IC0gdGhpcy5zaXplLnggLyAyIH0sXG4gICAgICAgIHsgeDogMCwgeTogLTYgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuZ2FtZS5hZGRCb2R5KGJ1bGxldCk7XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgeyBJbnZhZGVyIH0gZnJvbSBcIi4vaW52YWRlclwiO1xuaW1wb3J0IHsgQm9keSB9IGZyb20gXCIuL2dsb2JhbFwiO1xuXG5leHBvcnQgY2xhc3MgVXRpbCB7XG4gIHB1YmxpYyBzdGF0aWMgcHJvZHVjZUludmFkZXJzKGdhbWU6IGFueSkge1xuICAgIGxldCBpbnZhZGVyczogSW52YWRlcltdID0gW107XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI0OyBpKyspIHtcbiAgICAgIGxldCB4ID0gMzAgKyAoaSAlIDgpICogMzA7XG4gICAgICBsZXQgeSA9IDMwICsgKGkgJSAzKSAqIDMwO1xuICAgICAgaW52YWRlcnMucHVzaChuZXcgSW52YWRlcihnYW1lLCB7IHg6IHgsIHk6IHkgfSkpO1xuICAgIH1cblxuICAgIHJldHVybiBpbnZhZGVycztcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgY29sbGlkaW5nKGIxOiBCb2R5LCBiMjogQm9keSkge1xuICAgIHJldHVybiAhKFxuICAgICAgYjEgPT09IGIyIHx8XG4gICAgICBiMS5jZW50ZXIueCArIGIxLnNpemUueCAvIDIgPCBiMi5jZW50ZXIueCArIGIyLnNpemUueCAvIDIgfHxcbiAgICAgIGIxLmNlbnRlci55ICsgYjEuc2l6ZS55IC8gMiA8IGIyLmNlbnRlci55ICsgYjIuc2l6ZS55IC8gMiB8fFxuICAgICAgYjEuY2VudGVyLnggLSBiMS5zaXplLnggLyAyID4gYjIuY2VudGVyLnggKyBiMi5zaXplLnggLyAyIHx8XG4gICAgICBiMS5jZW50ZXIueSAtIGIxLnNpemUueSAvIDIgPiBiMi5jZW50ZXIueSArIGIyLnNpemUueSAvIDJcbiAgICApO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBkcmF3UmVjdChzY3JlZW46IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgYm9keTogQm9keSkge1xuICAgIHNjcmVlbi5maWxsUmVjdChcbiAgICAgIGJvZHkuY2VudGVyLnggLSBib2R5LnNpemUueCAvIDIsXG4gICAgICBib2R5LmNlbnRlci55IC0gYm9keS5zaXplLnkgLyAyLFxuICAgICAgYm9keS5zaXplLngsXG4gICAgICBib2R5LnNpemUueVxuICAgICk7XG4gIH1cbn1cbiJdfQ==
